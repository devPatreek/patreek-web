(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7029],{7029:function(e,t,n){"use strict";n.d(t,{ng:function(){return O},By:function(){return j},checkSessionStatus:function(){return T},EJ:function(){return b},sv:function(){return M},A9:function(){return q},I3:function(){return N},VN:function(){return x},A5:function(){return G},tG:function(){return v},lk:function(){return g},CP:function(){return w},Oh:function(){return P},U$:function(){return I},t0:function(){return C},TH:function(){return S},PK:function(){return U},ST:function(){return h},Dk:function(){return l},vK:function(){return E},tn:function(){return B},U1:function(){return p},Kn:function(){return f},HE:function(){return m},getUserProfile:function(){return d},Zm:function(){return u},pH:function(){return A},aK:function(){return K},Og:function(){return F},a$:function(){return y},Zh:function(){return k},w7:function(){return en},qB:function(){return L},eH:function(){return D},CC:function(){return z},vr:function(){return J},EW:function(){return _},D7:function(){return H},ck:function(){return ee},sS:function(){return R},gg:function(){return et}});let a="patreek_session";function o(e){try{window.localStorage.setItem(a,e)}catch(e){console.warn("[Session] Failed to write to localStorage:",e)}}function r(){try{window.localStorage.removeItem(a)}catch(e){console.warn("[Session] Failed to remove from localStorage:",e)}}function i(){let e=function(){try{return window.localStorage.getItem(a)}catch(e){return console.warn("[Session] Failed to read from localStorage:",e),null}}();return e?{"X-Session-Token":e}:{}}n(257);let c="https://api.patreek.com";function s(e){return{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(e)}}async function l(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),1e4),n=new URLSearchParams(window.location.search),a=null==n?void 0:n.get("bypass"),o="".concat(c,"/api/v1/feeds/public").concat("ag3nt007"===a?"?bypass=ag3nt007":""),r=await fetch(o,{method:"GET",cache:"default",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:e.signal});if(clearTimeout(t),!r.ok)return console.warn("[API] Failed to fetch public feeds: ".concat(r.status)),[];return((await r.json()).content||[]).slice(0,30)}catch(e){return e instanceof Error?"AbortError"===e.name||e.message.includes("timeout")||e.message.includes("TIMED_OUT")?console.warn("[API] Connection timeout while fetching public feeds - backend may be unavailable"):e.message.includes("Failed to fetch")||e.message.includes("ERR_CONNECTION")?console.warn("[API] Connection error while fetching public feeds - backend may be unavailable"):console.warn("[API] Error fetching public feeds:",e.message):console.warn("[API] Unknown error fetching public feeds:",e),[]}}async function u(e){try{let t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a=await fetch("".concat(c,"/api/v1/user/profile/username/").concat(encodeURIComponent(e)),{method:"GET",headers:{Accept:"application/json"},credentials:"include",signal:t.signal});if(clearTimeout(n),!a.ok){if(404===a.status)return null;return console.warn("[API] Failed to fetch user profile by username:",a.status),null}let o=await a.json(),r=o.data||o||null;return Q(r,e)}catch(e){return console.warn("[API] Error fetching user profile by username",e),null}}async function d(e){try{let t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a={Accept:"application/json"};e?Object.assign(a,s(e)):Object.assign(a,i());let o=await fetch("".concat(c,"/api/v1/user/profile"),{method:"GET",headers:a,credentials:"include",signal:t.signal});if(clearTimeout(n),!o.ok)return console.warn("[API] Failed to fetch user profile:",o.status),null;let r=await o.json(),l=r.data||r||null;return Q(l)}catch(e){return console.warn("[API] Error fetching user profile",e),null}}async function p(e){try{let t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a={Accept:"application/json"};e?Object.assign(a,s(e)):Object.assign(a,i());let o=await fetch("".concat(c,"/api/v1/categories"),{method:"GET",headers:a,credentials:"include",signal:t.signal});if(clearTimeout(n),!o.ok)return console.warn("[API] Failed to fetch user categories:",o.status),[];let r=await o.json();if(Array.isArray(r))return r;if(Array.isArray(null==r?void 0:r.content))return r.content;if(Array.isArray(null==r?void 0:r.categories))return r.categories;return[]}catch(e){return console.warn("[API] Error fetching user categories",e),[]}}async function f(e){try{let t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a={Accept:"application/json"};e?Object.assign(a,s(e)):Object.assign(a,i());let o=await fetch("".concat(c,"/api/v1/feeds"),{method:"GET",headers:a,credentials:"include",signal:t.signal});if(clearTimeout(n),!o.ok)return console.warn("[API] Failed to fetch user feeds:",o.status),[];return(await o.json()).content||[]}catch(e){return console.warn("[API] Error fetching user feeds",e),[]}}async function m(e,t){try{let n=new AbortController,a=setTimeout(()=>n.abort(),1e4),o={Accept:"application/json"};e?Object.assign(o,s(e)):Object.assign(o,i());let r=await fetch("".concat(c,"/api/v1/feeds/category/").concat(t),{method:"GET",headers:o,credentials:"include",signal:n.signal});if(clearTimeout(a),!r.ok)return console.warn("[API] Failed to fetch feeds for category:",r.status),[];return(await r.json()).content||[]}catch(e){return console.warn("[API] Error fetching category feeds",e),[]}}async function h(e){try{let t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a=new URLSearchParams(window.location.search),o=null==a?void 0:a.get("bypass"),r="".concat(c,"/api/v1/feeds/").concat(e).concat("ag3nt007"===o?"?bypass=ag3nt007":"");console.log("[API] Fetching article ".concat(e," from: ").concat(r));let i=await fetch(r,{method:"GET",cache:"default",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"omit",mode:"cors",signal:t.signal});if(clearTimeout(n),!i.ok){let t=/^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);if(404===i.status||403===i.status)return t&&console.error("[API] Safari: Article ".concat(e," returned ").concat(i.status,". Check if this is a CORS issue or if article is actually not found.")),console.warn("[API] Article ".concat(e," not found or not available (").concat(i.status,")")),null;return t&&console.error("[API] Safari: Failed to fetch feed ".concat(e,": ").concat(i.status,". Response headers:"),Object.fromEntries(i.headers.entries())),console.warn("[API] Failed to fetch feed ".concat(e,": ").concat(i.status)),null}let s=i.headers.get("content-type");s&&s.includes("application/json")||console.warn("[API] Unexpected content type: ".concat(s,". Expected application/json"));let l=await i.json();return console.log("[API] Successfully fetched article ".concat(e,":"),l.title),l}catch(t){if(t instanceof Error){let n=/^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);"AbortError"===t.name||t.message.includes("timeout")||t.message.includes("TIMED_OUT")?console.warn("[API] Connection timeout while fetching article ".concat(e," - backend may be unavailable")):t.message.includes("Failed to fetch")||t.message.includes("ERR_CONNECTION")||t.message.includes("NetworkError")?n?console.error("[API] Safari CORS/Network error while fetching article ".concat(e,". This might be a CORS configuration issue. Error:"),t.message):console.warn("[API] Connection error while fetching article ".concat(e," - backend may be unavailable")):t.message.includes("CORS")||t.message.includes("cross-origin")?console.error("[API] CORS error while fetching article ".concat(e,". Check backend CORS configuration. Error:"),t.message):console.warn("[API] Error fetching feed ".concat(e,":"),t.message)}else console.warn("[API] Unknown error fetching feed ".concat(e,":"),t);return null}}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;try{let a=new AbortController,o=setTimeout(()=>a.abort(),1e4),r=await fetch("".concat(c,"/api/v1/feeds/").concat(e,"/comments?page=").concat(t,"&size=").concat(n),{method:"GET",cache:"default",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:a.signal});if(clearTimeout(o),!r.ok)return console.warn("[API] Failed to fetch comments for feed ".concat(e,": ").concat(r.status)),[];return(await r.json()).content||[]}catch(t){return t instanceof Error?"AbortError"===t.name||t.message.includes("timeout")?console.warn("[API] Connection timeout while fetching comments for feed ".concat(e)):console.warn("[API] Error fetching comments for feed ".concat(e,":"),t.message):console.warn("[API] Unknown error fetching comments for feed ".concat(e,":"),t),[]}}async function w(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),1e4),n=await fetch("".concat(c,"/api/v1/categories"),{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:e.signal});if(clearTimeout(t),!n.ok)return console.warn("[API] Failed to fetch categories:",n.status),[];let a=await n.json();if(Array.isArray(a))return a;if(Array.isArray(null==a?void 0:a.content))return a.content;if(Array.isArray(null==a?void 0:a.categories))return a.categories;return[]}catch(e){return e instanceof Error&&"AbortError"===e.name?console.warn("[API] Categories request timed out"):console.warn("[API] Error fetching categories",e),[]}}async function v(){try{console.log("[API] Fetching all categories from:","".concat(c,"/api/v1/categories"));let e=new AbortController,t=setTimeout(()=>e.abort(),1e4),n=await fetch("".concat(c,"/api/v1/categories"),{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:e.signal});if(clearTimeout(t),console.log("[API] All categories response status:",n.status),!n.ok){console.warn("[API] Failed to fetch all categories:",n.status,n.statusText);let e=await n.text();return console.warn("[API] Error response body:",e),[]}let a=await n.json();if(console.log("[API] All categories data received:",a),Array.isArray(a))return console.log("[API] Returning",a.length,"top-level categories"),a;if(Array.isArray(null==a?void 0:a.content))return console.log("[API] Returning",a.content.length,"categories from content"),a.content;if(Array.isArray(null==a?void 0:a.categories))return console.log("[API] Returning",a.categories.length,"categories from categories"),a.categories;return console.warn("[API] Unexpected data format:",a),[]}catch(e){return e instanceof Error&&"AbortError"===e.name?console.warn("[API] All categories request timed out"):console.error("[API] Error fetching all categories",e),[]}}async function y(e){let t=new AbortController,n=setTimeout(()=>t.abort(),15e3);try{var a;let r=await fetch("".concat(c,"/api/v1/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e),signal:t.signal});if(clearTimeout(n),!r.ok){let e=await r.text();throw Error(e||"Unable to sign up right now")}let i=await r.json();return i.token?o(i.token):(null===(a=i.data)||void 0===a?void 0:a.token)&&o(i.data.token),i}catch(e){if(clearTimeout(n),e instanceof Error&&"AbortError"===e.name)throw Error("Signup timed out, please try again");throw e instanceof Error?e:Error("Unknown signup error")}}async function A(e){let t=new AbortController,n=setTimeout(()=>t.abort(),15e3);try{var a;let r=await fetch("".concat(c,"/api/v1/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e),signal:t.signal});if(clearTimeout(n),!r.ok){let e=await r.text();throw Error(e||"Unable to sign in right now")}let i=await r.json();return i.token?o(i.token):(null===(a=i.data)||void 0===a?void 0:a.token)&&o(i.data.token),i}catch(e){if(clearTimeout(n),e instanceof Error&&"AbortError"===e.name)throw Error("Sign in timed out, please try again");throw e instanceof Error?e:Error("Unknown sign in error")}}async function T(){try{var e,t;let n=new AbortController,a=setTimeout(()=>n.abort(),5e3),o=i(),r=await fetch("".concat(c,"/api/v1/auth/session"),{method:"GET",headers:{Accept:"application/json",...o},credentials:"include",signal:n.signal});if(clearTimeout(a),!r.ok)return{authenticated:!1};let s=await r.json();return{authenticated:(null===(e=s.data)||void 0===e?void 0:e.authenticated)===!0,message:null===(t=s.data)||void 0===t?void 0:t.message}}catch(e){return console.warn("[API] Error checking session status:",e),{authenticated:!1}}}async function b(e){let t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{var a,o,r;let i=await fetch("".concat(c,"/api/v1/user/username/").concat(encodeURIComponent(e)),{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:t.signal});if(clearTimeout(n),i.ok){let e=await i.json();return{available:!0,message:(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.message)||"Username is available"}}let s="Username is not available";try{let e=await i.json();s=(null==e?void 0:null===(o=e.error)||void 0===o?void 0:o.message)||(null==e?void 0:e.message)||(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.message)||s}catch(e){try{s=await i.text()||s}catch(e){}}if(403===i.status)return{available:!1,message:s};return i.status,{available:!1,message:s}}catch(e){throw clearTimeout(n),e instanceof Error?e:Error("Unable to check username")}}async function j(e){let t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{var a,o,r;let i=await fetch("".concat(c,"/api/v1/user/email/").concat(encodeURIComponent(e)),{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:t.signal});if(clearTimeout(n),i.ok){let e=await i.json();return{available:!0,message:(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.message)||"Email is available"}}let s="Email is not available";try{let e=await i.json();s=(null==e?void 0:null===(o=e.error)||void 0===o?void 0:o.message)||(null==e?void 0:e.message)||(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.message)||s}catch(e){try{s=await i.text()||s}catch(e){}}if(403===i.status)return{available:!1,message:s||"Email is already registered"};if(400===i.status)return{available:!1,message:s||"Invalid email format"};return{available:!1,message:s}}catch(e){throw clearTimeout(n),e instanceof Error?e:Error("Unable to check email")}}async function E(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),8e3),n=await fetch("".concat(c,"/api/v1/analytics/top-coin-holder"),{method:"GET",headers:{Accept:"application/json"},cache:"no-store",signal:e.signal});if(clearTimeout(t),!n.ok)return console.warn("[API] Failed to fetch top coin holder:",n.status),{};let a=await n.json();return{username:a.username,name:a.name,patCoins:a.patCoins}}catch(e){return console.warn("[API] Error fetching top coin holder:",e),{}}}async function I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=new AbortController,a=setTimeout(()=>n.abort(),8e3);try{let o=await fetch("".concat(c,"/api/v1/community/leaderboard?metric=").concat(e,"&limit=").concat(t),{method:"GET",headers:{Accept:"application/json"},cache:"no-store",signal:n.signal});if(clearTimeout(a),!o.ok)return console.warn("[API] leaderboard request failed",o.status),Z(e);let r=await o.json();return((null==r?void 0:r.data)||(null==r?void 0:r.content)||r||[]).map((e,t)=>{var n,a,o;let r="number"==typeof e.rank?e.rank:"number"==typeof(null===(n=e.rank)||void 0===n?void 0:n.level)?e.rank.level:t+1;return{username:e.username||e.name||"user-".concat(t+1),displayName:e.displayName||e.name,avatarUrl:e.avatarUrl,total:null!==(o=null!==(a=e.total)&&void 0!==a?a:e.score)&&void 0!==o?o:0,rank:r}})}catch(t){return clearTimeout(a),console.warn("[API] leaderboard error",t),Z(e)}}async function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global",t=arguments.length>1?arguments[1]:void 0,n=new AbortController,a=setTimeout(()=>n.abort(),8e3);try{let o=new URL("".concat(c,"/api/v1/community/chat/history"));o.searchParams.set("roomId",e),t&&o.searchParams.set("cursor",t);let r=await fetch(o.toString(),{method:"GET",headers:{Accept:"application/json",...i()},credentials:"include",signal:n.signal});if(clearTimeout(a),!r.ok)return console.warn("[API] chat history request failed",r.status),W();let s=await r.json();return((null==s?void 0:s.data)||(null==s?void 0:s.messages)||s||[]).map((t,n)=>{var a;return{id:(null===(a=t.id)||void 0===a?void 0:a.toString())||"".concat(e,"-").concat(n),username:t.username||t.user||"anon",displayName:t.displayName||t.name,avatarUrl:t.avatarUrl,text:t.text||t.message||"",createdAt:t.createdAt||t.timestamp||new Date().toISOString()}})}catch(e){return clearTimeout(a),console.warn("[API] chat history error",e),W()}}async function k(e,t,n){let a=new AbortController,o=setTimeout(()=>a.abort(),8e3);try{let r={roomId:e,text:t};(null==n?void 0:n.name)&&(r.command=n.name,n.args&&(r.args=n.args));let s=await fetch("".concat(c,"/api/v1/community/chat/message"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...i()},credentials:"include",body:JSON.stringify(r),signal:a.signal});if(clearTimeout(o),!s.ok)return console.warn("[API] chat send failed",s.status),!1;return!0}catch(e){return clearTimeout(o),console.warn("[API] chat send error",e),!1}}async function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=new AbortController,n=setTimeout(()=>t.abort(),8e3);try{let a=await fetch("".concat(c,"/api/v1/notifications?limit=").concat(e),{method:"GET",headers:{Accept:"application/json",...i()},credentials:"include",cache:"no-store",signal:t.signal});if(clearTimeout(n),!a.ok)return console.warn("[API] notifications request failed",a.status),$();let o=await a.json();return((null==o?void 0:o.data)||(null==o?void 0:o.content)||o||[]).map((e,t)=>{var n,a,o,r,i;return{id:String(null!==(n=e.id)&&void 0!==n?n:"notif-".concat(t)),type:null!==(a=e.type)&&void 0!==a?a:"system",title:null!==(o=e.title)&&void 0!==o?o:"Notification",message:null!==(r=e.message)&&void 0!==r?r:"",actorUsername:e.actorUsername,resourceType:e.resourceType,resourceId:e.resourceId,isRead:!!e.isRead,createdAt:null!==(i=e.createdAt)&&void 0!==i?i:new Date().toISOString()}})}catch(e){return clearTimeout(n),console.warn("[API] notifications error",e),$()}}async function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=new AbortController,a=setTimeout(()=>n.abort(),1e4);try{var o,r,s,l,u,d,p;let f=await fetch("".concat(c,"/api/v1/message-nest?page=").concat(e,"&size=").concat(t,"&sort=createdAt&direction=DESC"),{method:"GET",headers:{Accept:"application/json",...i()},credentials:"include",cache:"no-store",signal:n.signal});if(clearTimeout(a),!f.ok)return console.warn("[API] message nest request failed",f.status),{content:[],totalElements:0,totalPages:0};let m=await f.json(),h=(null==m?void 0:null===(o=m.data)||void 0===o?void 0:o.content)||(null==m?void 0:m.content)||(null==m?void 0:m.data)||[];return{content:h.map(e=>{var t,n,a,o,r,i;return{id:null!==(t=e.id)&&void 0!==t?t:e.messageId,senderId:e.senderId,senderUsername:e.senderUsername,senderName:e.senderName,recipientId:e.recipientId,recipientUsername:e.recipientUsername,recipientName:e.recipientName,subject:e.subject,body:null!==(a=null!==(n=e.body)&&void 0!==n?n:e.message)&&void 0!==a?a:"",read:!!e.read,readAt:e.readAt,createdAt:null!==(r=null!==(o=e.createdAt)&&void 0!==o?o:e.created_at)&&void 0!==r?r:new Date().toISOString(),updatedAt:null!==(i=e.updatedAt)&&void 0!==i?i:e.updated_at}}),totalElements:null!==(u=null!==(l=null==m?void 0:null===(r=m.data)||void 0===r?void 0:r.totalElements)&&void 0!==l?l:null==m?void 0:m.totalElements)&&void 0!==u?u:h.length,totalPages:null!==(p=null!==(d=null==m?void 0:null===(s=m.data)||void 0===s?void 0:s.totalPages)&&void 0!==d?d:null==m?void 0:m.totalPages)&&void 0!==p?p:1}}catch(e){return clearTimeout(a),console.warn("[API] message nest error",e),{content:[],totalElements:0,totalPages:0}}}async function U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2?arguments[2]:void 0,a=new URLSearchParams({page:e.toString(),size:t.toString()});n&&a.append("categoryId",n.toString());let o=await fetch("".concat(c,"/api/v1/opinions?").concat(a),{method:"GET",headers:{Accept:"application/json"},credentials:"omit"});if(!o.ok)throw Error("Failed to fetch opinions: ".concat(o.statusText));return(await o.json()).data}async function O(){try{var e;let t=new AbortController,n=setTimeout(()=>t.abort(),3e3),a=await fetch("".concat(c,"/api/v1/admin/session"),{method:"GET",headers:{Accept:"application/json"},credentials:"include",signal:t.signal});if(clearTimeout(n),!a.ok)return console.warn("[Admin] Session check failed:",a.status,a.statusText),!1;let o=await a.json(),r=(null===(e=o.data)||void 0===e?void 0:e.authenticated)===!0;return console.log("[Admin] Session check result:",r),r}catch(e){return"AbortError"===e.name?console.warn("[Admin] Session check timed out"):console.warn("[Admin] Session check error:",e.message||e),!1}}async function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2?arguments[2]:void 0,a=new URLSearchParams({page:e.toString(),size:t.toString()});n&&a.append("status",n);let o=await fetch("".concat(c,"/api/v1/admin/support-messages?").concat(a),{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!o.ok)throw Error("Failed to fetch support messages");return(await o.json()).data||{content:[],totalElements:0,totalPages:0,number:0,size:20}}async function F(e){if(!(await fetch("".concat(c,"/api/v1/admin/support-messages/").concat(e,"/read"),{method:"PATCH",headers:{Accept:"application/json"},credentials:"include"})).ok)throw Error("Failed to mark message as read")}async function R(e,t){if(!(await fetch("".concat(c,"/api/v1/admin/support-messages/").concat(e,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({status:t})})).ok)throw Error("Failed to update message status")}async function x(e){let t=await fetch("".concat(c,"/api/v1/admin/users/email/").concat(encodeURIComponent(e)),{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!t.ok){var n;let e=await t.json();throw Error((null==e?void 0:e.message)||(null==e?void 0:null===(n=e.error)||void 0===n?void 0:n.message)||"Failed to fetch user by email")}return(await t.json()).data}async function G(e){let t=await fetch("".concat(c,"/api/v1/admin/users/username/").concat(encodeURIComponent(e)),{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!t.ok){var n;let e=await t.json();throw Error((null==e?void 0:e.message)||(null==e?void 0:null===(n=e.error)||void 0===n?void 0:n.message)||"Failed to fetch user by username")}return(await t.json()).data}async function J(e,t){let n=await fetch("".concat(c,"/api/v1/admin/users/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(t)});if(!n.ok)throw Error((await n.json()).message||"Failed to update user");return(await n.json()).data}async function L(e,t){let n=await fetch("".concat(c,"/api/v1/admin/users/").concat(e,"/suspend"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({reason:t})});if(!n.ok)throw Error((await n.json()).message||"Failed to suspend user");return(await n.json()).data}async function D(e){let t=await fetch("".concat(c,"/api/v1/admin/users/").concat(e,"/unsuspend"),{method:"POST",headers:{Accept:"application/json"},credentials:"include"});if(!t.ok)throw Error((await t.json()).message||"Failed to unsuspend user");return(await t.json()).data}async function _(e,t){let n=await fetch("".concat(c,"/api/v1/admin/users/").concat(e,"/coins"),{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({coins:t})});if(!n.ok)throw Error((await n.json()).message||"Failed to update user coins");return(await n.json()).data}async function H(e,t){let n=await fetch("".concat(c,"/api/v1/admin/users/").concat(e,"/rank"),{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({level:t})});if(!n.ok)throw Error((await n.json()).message||"Failed to update user rank");return(await n.json()).data}async function q(){let e=await fetch("".concat(c,"/api/v1/admin/categories"),{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch categories");return(await e.json()).data||[]}async function z(e,t){let n=await fetch("".concat(c,"/api/v1/admin/categories/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(t)});if(!n.ok){var a;let e=await n.json();throw Error((null==e?void 0:e.message)||(null==e?void 0:null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update category")}return(await n.json()).data}async function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=arguments.length>2?arguments[2]:void 0,a=new URLSearchParams({page:e.toString(),size:t.toString()});n&&a.append("actionType",n);let o=await fetch("".concat(c,"/api/v1/admin/activity-logs?").concat(a),{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!o.ok)throw Error("Failed to fetch activity logs");return(await o.json()).data||{content:[],totalElements:0,totalPages:0,number:0,size:50}}async function K(e){let t=new AbortController,n=setTimeout(()=>t.abort(),8e3);try{await fetch("".concat(c,"/api/v1/notifications/read"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...i()},credentials:"include",cache:"no-store",signal:t.signal,body:JSON.stringify({ids:e&&e.length?e:void 0,all:!e||!e.length})})}catch(e){console.warn("[API] mark notifications read error",e)}finally{clearTimeout(n)}}async function B(){let e=new AbortController,t=setTimeout(()=>e.abort(),8e3);try{var n,a;let o=await fetch("".concat(c,"/api/v1/notifications/unread-count"),{method:"GET",headers:{Accept:"application/json",...i()},credentials:"include",cache:"no-store",signal:e.signal});if(clearTimeout(t),!o.ok)return console.warn("[API] unread count request failed",o.status),$().filter(e=>!e.isRead).length;let r=await o.json();return null!==(a=null!==(n=null==r?void 0:r.count)&&void 0!==n?n:null==r?void 0:r.total)&&void 0!==a?a:0}catch(e){return clearTimeout(t),console.warn("[API] unread count error",e),$().filter(e=>!e.isRead).length}}function Z(e){return["Ava","Liam","Noah","Mia","Ethan","Zara","Leo","Sofia","Mateo","Isla"].map((t,n)=>({username:"".concat(t.toLowerCase()).concat(n+1),displayName:t,total:1200-47*n+("pats"===e?30:0),rank:n+1}))}function W(){let e=Date.now();return[{id:"c1",username:"sam",displayName:"Sam",text:"Welcome to the community lounge!",createdAt:new Date(e-12e4).toISOString()},{id:"c2",username:"jules",displayName:"Jules",text:"Leaderboard just updated â€” go sharers!",createdAt:new Date(e-3e4).toISOString()}]}function $(){let e=Date.now();return[{id:"n1",type:"tip_received",title:"You received a tip",message:"@jules sent you 2.5 Pat Coins",actorUsername:"jules",isRead:!1,createdAt:new Date(e-3e5).toISOString()},{id:"n2",type:"comment_reply",title:"New reply on your post",message:"@sam replied to your comment",actorUsername:"sam",isRead:!0,createdAt:new Date(e-27e5).toISOString()}]}let V=()=>!0,X=e=>e?"".concat("pat_avatar_").concat(e.toLowerCase()):"";function Y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:432e5;if(V()&&e&&t)try{let a={url:t,expiresAt:Date.now()+n};localStorage.setItem(X(e),JSON.stringify(a)),document.cookie="".concat(X(e),"=").concat(encodeURIComponent(t),"; max-age=").concat(Math.floor(n/1e3),"; path=/")}catch(e){}}function Q(e,t){if(!e)return e;let n=e.username||t,a=function(e){if(!V()||!e)return null;try{let t=localStorage.getItem(X(e));if(!t)return null;let n=JSON.parse(t);if(!(null==n?void 0:n.url)||!(null==n?void 0:n.expiresAt)||Date.now()>n.expiresAt)return localStorage.removeItem(X(e)),null;return n.url}catch(e){return null}}(n);return a&&!e.avatarUrl?e.avatarUrl=a:e.avatarUrl&&n&&Y(n,e.avatarUrl),e}async function ee(e){try{let t=new AbortController,n=setTimeout(()=>t.abort(),1e4),a=i(),o=await fetch("".concat(c,"/api/v1/user/profile"),{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json",...a},credentials:"include",body:JSON.stringify(e),signal:t.signal});if(clearTimeout(n),!o.ok){let e=await o.text(),t="Failed to update profile";try{let n=JSON.parse(e);t=n.message||n.error||t}catch(n){t=e||t}throw Error(t)}let r=await o.json();return r.data||r}catch(e){if(e instanceof Error&&"AbortError"===e.name)throw Error("Update timed out, please try again");throw e instanceof Error?e:Error("Unknown error updating profile")}}async function et(e){try{let t=new AbortController,n=setTimeout(()=>t.abort(),2e4),a={Accept:"application/json","Content-Type":"application/json",...i()},o=await fetch("".concat(c,"/api/v1/user/profile/avatar/presign"),{method:"POST",headers:a,credentials:"include",body:JSON.stringify({contentType:e.type||"application/octet-stream",contentLength:e.size}),signal:t.signal});if(!o.ok)return clearTimeout(n),console.warn("[API] Avatar presign failed:",o.status),null;let r=await o.json(),s=(null==r?void 0:r.data)||r;if(!(null==s?void 0:s.uploadUrl)||!(null==s?void 0:s.key))return clearTimeout(n),console.warn("[API] Invalid presign payload",r),null;let l={};e.type&&(l["Content-Type"]=e.type);let u=await fetch(s.uploadUrl,{method:"PUT",headers:l,body:e,signal:t.signal});if(!u.ok)return clearTimeout(n),console.warn("[API] Avatar PUT failed:",u.status),null;let d=await fetch("".concat(c,"/api/v1/user/profile/avatar/confirm"),{method:"POST",headers:a,credentials:"include",body:JSON.stringify({key:s.key,publicUrl:s.publicUrl}),signal:t.signal});if(clearTimeout(n),!d.ok)return console.warn("[API] Avatar confirm failed:",d.status),s.publicUrl||null;let p=await d.json(),f=(null==p?void 0:p.data)||p||null,m=(null==f?void 0:f.avatarUrl)||s.publicUrl||null;return m&&Y(null==f?void 0:f.username,m),m}catch(e){return console.warn("[API] Avatar upload error:",e),null}}async function en(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),n=i(),a=await fetch("".concat(c,"/api/v1/auth/signout"),{method:"POST",headers:{Accept:"application/json",...n},credentials:"include",signal:e.signal});clearTimeout(t),r(),a.ok||console.warn("[API] Sign-out request failed:",a.status)}catch(e){r(),console.warn("[API] Error during sign-out:",e)}}},257:function(e,t,n){"use strict";var a,o;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,a,o=e.exports={};function r(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var s=[],l=!1,u=-1;function d(){l&&a&&(l=!1,a.length?s=a.concat(s):u=-1,s.length&&p())}function p(){if(!l){var e=c(d);l=!0;for(var t=s.length;t;){for(a=s,s=[];++u<t;)a&&a[u].run();u=-1,t=s.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new f(e,t)),1!==s.length||l||c(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function a(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}},i=!0;try{t[e](r,r.exports,a),i=!1}finally{i&&delete n[e]}return r.exports}a.ab="//";var o=a(229);e.exports=o}()}}]);