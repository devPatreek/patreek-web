(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8654],{2782:function(e,a,s){Promise.resolve().then(s.bind(s,1169))},1169:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return d}});var t=s(7437),n=s(2265),r=s(9376),i=s(3595),o=s(8349),l=s(7029),c=s(306),m=s.n(c);function d(){let e=(0,r.useRouter)(),[a,s]=(0,n.useState)(!0),[c,d]=(0,n.useState)(!1),[g,h]=(0,n.useState)(null),[_,u]=(0,n.useState)([]),[p,x]=(0,n.useState)(!1),[j,N]=(0,n.useState)(0),[v,f]=(0,n.useState)(!0),[y,S]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{if((await (0,l.checkSessionStatus)()).authenticated){d(!0);let e=await (0,l.getUserProfile)();h(e);let a="true"===localStorage.getItem("darkMode");S(a)}else e.replace("/registration")}catch(a){console.error("Error checking session:",a),e.replace("/registration")}finally{s(!1)}})()},[e]),(0,n.useEffect)(()=>{c&&(async()=>{x(!0);try{let e=await (0,l.t0)(j,20);0===j?u(e.content):u(a=>[...a,...e.content]),f(20===e.content.length&&j<e.totalPages-1)}catch(e){console.error("Error loading messages:",e)}finally{x(!1)}})()},[c,j]);let b=e=>{if(!e)return"";try{let a=new Date(e),s=new Date().getTime()-a.getTime(),t=Math.floor(s/6e4),n=Math.floor(s/36e5),r=Math.floor(s/864e5);if(t<1)return"now";if(t<60)return"".concat(t,"m");if(n<24)return"".concat(n,"h");if(r<7)return"".concat(r,"d");return a.toLocaleDateString()}catch(a){return e}},k=e=>{if(!e)return"";try{return new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}catch(a){return e}},w=e=>e?e.split(" ").map(e=>{var a;return null===(a=e[0])||void 0===a?void 0:a.toUpperCase()}).join("").slice(0,2):"U";return a?(0,t.jsxs)("div",{className:"".concat(m().page," ").concat(y?m().dark:""),children:[(0,t.jsx)(i.Z,{hasSession:!0}),(0,t.jsx)("div",{className:m().loading,children:(0,t.jsx)("p",{children:"Loading your nest..."})}),(0,t.jsx)(o.Z,{})]}):c?(0,t.jsxs)("div",{className:"".concat(m().page," ").concat(y?m().dark:""),children:[(0,t.jsx)(i.Z,{hasSession:!0}),(0,t.jsx)("main",{className:m().main,children:(0,t.jsxs)("div",{className:m().container,children:[(0,t.jsxs)("header",{className:m().header,children:[(0,t.jsx)("h1",{className:m().title,children:"Message Nest"}),(0,t.jsx)("p",{className:m().subtitle,children:"Your conversations"})]}),(0,t.jsx)("div",{className:m().messagesList,children:p&&0===_.length?(0,t.jsx)("div",{className:m().emptyState,children:(0,t.jsx)("p",{children:"Loading messages..."})}):0===_.length?(0,t.jsxs)("div",{className:m().emptyState,children:[(0,t.jsx)("p",{children:"No messages yet."}),(0,t.jsx)("p",{className:m().emptySubtext,children:"Start a conversation with someone!"})]}):_.map(e=>{let a=e.senderId===(null==g?void 0:g.id)?{name:e.recipientName,username:e.recipientUsername,id:e.recipientId}:{name:e.senderName,username:e.senderUsername,id:e.senderId};return(0,t.jsxs)("article",{className:m().messageCard,children:[(0,t.jsxs)("div",{className:m().messageHeader,children:[(0,t.jsx)("div",{className:m().messageAvatar,children:a.name?(0,t.jsx)("span",{className:m().avatarInitials,children:w(a.name)}):(0,t.jsx)("span",{className:m().avatarInitials,children:"U"})}),(0,t.jsxs)("div",{className:m().messageMeta,children:[(0,t.jsxs)("div",{className:m().messageNameRow,children:[(0,t.jsx)("span",{className:m().messageName,children:a.name||a.username||"Unknown User"}),a.username&&(0,t.jsxs)("span",{className:m().messageUsername,children:["@",a.username]}),(0,t.jsx)("span",{className:m().messageTime,children:b(e.createdAt)})]}),e.subject&&(0,t.jsx)("div",{className:m().messageSubject,children:e.subject})]}),(0,t.jsx)("div",{className:m().messageActions,children:(0,t.jsx)("button",{className:m().actionButton,"aria-label":"More options",children:(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"1"}),(0,t.jsx)("circle",{cx:"12",cy:"5",r:"1"}),(0,t.jsx)("circle",{cx:"12",cy:"19",r:"1"})]})})})]}),(0,t.jsx)("div",{className:m().messageBody,children:(0,t.jsx)("p",{className:m().messageText,children:e.body})}),(0,t.jsxs)("div",{className:m().messageFooter,children:[(0,t.jsx)("button",{className:m().footerButton,"aria-label":"Reply",children:(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,t.jsx)("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),(0,t.jsx)("path",{d:"M21 3v5h-5"}),(0,t.jsx)("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),(0,t.jsx)("path",{d:"M3 21v-5h5"})]})}),(0,t.jsx)("button",{className:m().footerButton,"aria-label":"Share",children:(0,t.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,t.jsx)("path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"}),(0,t.jsx)("polyline",{points:"16 6 12 2 8 6"}),(0,t.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"15"})]})}),(0,t.jsx)("button",{className:m().footerButton,"aria-label":"Bookmark",children:(0,t.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,t.jsx)("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})}),(0,t.jsx)("span",{className:m().messageDate,children:k(e.createdAt)})]})]},e.id)})}),v&&(0,t.jsx)("div",{className:m().loadMore,children:(0,t.jsx)("button",{className:m().loadMoreButton,onClick:()=>N(e=>e+1),disabled:p,children:p?"Loading...":"Load more"})})]})}),(0,t.jsx)(o.Z,{})]}):null}},306:function(e){e.exports={page:"page_page__itoSM",dark:"page_dark__Lf8Sd",main:"page_main__iS3Fz",container:"page_container__gohJh",header:"page_header__iNAxZ",title:"page_title__lixyV",subtitle:"page_subtitle__2yz2c",loading:"page_loading__rxRIz",emptyState:"page_emptyState__8KOx2",emptySubtext:"page_emptySubtext__7w0Xf",messagesList:"page_messagesList__4aKVo",messageCard:"page_messageCard__8e7fF",messageHeader:"page_messageHeader__bUeJC",messageAvatar:"page_messageAvatar__EVRYD",avatarInitials:"page_avatarInitials__7yJAM",messageMeta:"page_messageMeta__tyk1P",messageNameRow:"page_messageNameRow__2IVKE",messageName:"page_messageName__fDD3i",messageUsername:"page_messageUsername__nXD7l",messageTime:"page_messageTime__uyx0W",messageSubject:"page_messageSubject__pBP4y",messageActions:"page_messageActions__I_IvT",actionButton:"page_actionButton__lFK8p",messageBody:"page_messageBody__EJkDi",messageText:"page_messageText__lyKWq",messageFooter:"page_messageFooter__HsWe7",footerButton:"page_footerButton__ZTegW",messageDate:"page_messageDate__e_xvR",loadMore:"page_loadMore__1vdkB",loadMoreButton:"page_loadMoreButton__AzHmG"}}},function(e){e.O(0,[563,2972,5726,1908,7611,2971,2117,1744],function(){return e(e.s=2782)}),_N_E=e.O()}]);