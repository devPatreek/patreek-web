(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8659],{8349:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var n=a(7437),s=a(7648),i=a(1468),r=a.n(i);let o=[{label:"Privacy",href:"/privacy"},{label:"Terms",href:"/terms"},{label:"Help",href:"/help"},{label:"About",href:"/about"}],l=[{label:"X",href:"https://x.com/patreek",aria:"Open Patreek on X"},{label:"Facebook",href:"https://facebook.com",aria:"Open Patreek on Facebook"},{label:"Instagram",href:"https://instagram.com",aria:"Open Patreek on Instagram"}];function c(){let e=new Date().getFullYear();return(0,n.jsxs)("footer",{className:r().footer,children:[(0,n.jsx)("div",{className:r().links,children:o.map(e=>(0,n.jsx)(s.default,{href:e.href,className:r().link,children:e.label},e.label))}),(0,n.jsxs)("div",{className:r().right,children:[(0,n.jsxs)("span",{className:r().copy,children:["\xa9 ",e," Patreek"]}),(0,n.jsx)("div",{className:r().socials,children:l.map(e=>(0,n.jsx)("a",{href:e.href,target:"_blank",rel:"noopener noreferrer","aria-label":e.aria,className:r().socialButton,children:"X"===e.label?"X":e.label.charAt(0)},e.label))})]})]})}},1224:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});var n=a(7437),s=a(2265),i=a(7648),r=a(9376),o=a(6914),l=a.n(o),c=a(7029);function d(e){let{hasSession:t=!1,active:a}=e,o=(0,r.useRouter)(),d=(0,r.usePathname)(),[u,_]=(0,s.useState)(null),[m,p]=(0,s.useState)(!1),[b,v]=(0,s.useState)(null),N=(0,s.useMemo)(()=>null==a?void 0:a.toLowerCase(),[a]),f=[{label:"Coins",path:"/coins"},{label:"Community",path:"/community"},{label:"Shop",path:"https://shop.patreek.com"},{label:"Opinion",path:"/opinion"},{label:"Write",path:"/write"}];(0,s.useEffect)(()=>{(async()=>{if(t)try{if(!(await (0,c.r$)()).authenticated)return;let e=await (0,c.getUserProfile)();(null==e?void 0:e.username)&&_(e.username)}catch(e){_(null)}})()},[t]),(0,s.useEffect)(()=>{let e=!1;return(async()=>{try{let t=await (0,c.$0)();!e&&t&&Number.isFinite(t.unitPrice)&&v(t.unitPrice)}catch(e){console.warn("[Header] Failed to load Pat Coin price",e)}})(),()=>{e=!0}},[]);let g=e=>!!(N&&N===e.label.toLowerCase()||d&&e.path.startsWith("/")&&d.startsWith(e.path)),x=(0,s.useMemo)(()=>{let e=null!=b?b:.01;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:4}).format(e)},[b]);return(0,n.jsxs)("header",{className:l().header,children:[(0,n.jsx)("div",{className:l().brand,onClick:()=>o.push("/"),children:"Patreek"}),(0,n.jsx)("nav",{className:l().nav,children:f.map(e=>(0,n.jsx)(i.default,{href:e.path,className:"".concat(l().navLink," ").concat(g(e)?l().activeLink:""),target:e.path.startsWith("http")?"_blank":void 0,children:e.label},e.label))}),(0,n.jsxs)("div",{className:l().actions,children:[(0,n.jsxs)(i.default,{href:"/coins",className:l().coinWidget,"aria-label":"Open Pat Coins — 1 P equals ".concat(x),children:[(0,n.jsx)(h,{className:l().coinIcon}),(0,n.jsxs)("div",{className:l().coinText,children:[(0,n.jsx)("span",{className:l().coinLabel,children:"Pat Coin"}),(0,n.jsxs)("span",{className:l().coinValue,children:["1\xa0P = ",x]})]})]}),(0,n.jsx)("button",{type:"button",className:l().profileCircle,onClick:()=>{t&&u?o.push("/u/".concat(u)):o.push("/registration")},"aria-label":"Open profile",children:u?u[0].toUpperCase():"P"}),(0,n.jsxs)("button",{type:"button",className:l().hamburger,onClick:()=>p(e=>!e),"aria-label":"Toggle navigation",children:[(0,n.jsx)("span",{}),(0,n.jsx)("span",{}),(0,n.jsx)("span",{})]})]}),m&&(0,n.jsx)("div",{className:l().mobileNav,children:f.map(e=>(0,n.jsx)(i.default,{href:e.path,className:l().mobileNavItem,onClick:()=>p(!1),children:e.label},e.label))})]})}function h(e){let{className:t}=e,a=(0,s.useId)();return(0,n.jsxs)("svg",{className:t,viewBox:"0 0 32 32",role:"presentation","aria-hidden":"true",focusable:"false",children:[(0,n.jsx)("defs",{children:(0,n.jsxs)("linearGradient",{id:a,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,n.jsx)("stop",{offset:"0%",stopColor:"#a855f7"}),(0,n.jsx)("stop",{offset:"45%",stopColor:"#6366f1"}),(0,n.jsx)("stop",{offset:"100%",stopColor:"#2563eb"})]})}),(0,n.jsx)("circle",{cx:"16",cy:"16",r:"15",fill:"url(#".concat(a,")")}),(0,n.jsx)("circle",{cx:"16",cy:"16",r:"14",fill:"none",stroke:"rgba(255,255,255,0.35)",strokeWidth:"1.5"}),(0,n.jsx)("path",{d:"M11.5 9h6.2c3 0 5.3 2.2 5.3 4.9 0 2.6-2.3 4.9-5.3 4.9h-3.1v4.2h-3.1V9zm6 7.1c1.3 0 2.2-.9 2.2-2.1s-.9-2-2.2-2h-2.9v4.1z",fill:"#fff"})]})}},3772:function(e,t,a){"use strict";a.d(t,{Z:function(){return v}});var n=a(7437),s=a(2265),i=a(166),r=a(5323),o=a(2023),l=a(2653),c=a.n(l),d=a(7029),h=a(8950),u=a.n(h);let _=(0,i.default)(()=>Promise.all([a.e(4560),a.e(8497)]).then(a.bind(a,1799)),{loadableGenerated:{webpack:()=>[1799]},ssr:!1}),m=e=>{var t,a,n,s,i,r,o,l,c,d,h,u,_,m,p,b,v;let N=null!==(c=null===(t=(a=null!==(l=null!==(o=null!==(r=null!==(i=e.senderId)&&void 0!==i?i:e.userId)&&void 0!==r?r:e.senderUserId)&&void 0!==o?o:e.senderUsername)&&void 0!==l?l:"unknown").toString)||void 0===t?void 0:t.call(a))&&void 0!==c?c:"unknown",f=null!==(h=null!==(d=e.createdAt)&&void 0!==d?d:e.timestamp)&&void 0!==h?h:new Date().toISOString(),g=null!==(m=null!==(_=null!==(u=e.body)&&void 0!==u?u:e.text)&&void 0!==_?_:e.message)&&void 0!==m?m:"";return{id:null!==(p=null===(s=e.id)||void 0===s?void 0:null===(n=s.toString)||void 0===n?void 0:n.call(s))&&void 0!==p?p:"".concat(N,"-").concat(f),senderId:N,senderName:null!==(v=null!==(b=e.senderName)&&void 0!==b?b:e.displayName)&&void 0!==v?v:e.senderUsername,body:g,createdAt:f}},p=async e=>{var t,a,n;let s=await fetch(e,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!s.ok)throw Error("Unable to load chat history");let i=await s.json(),r=null!==(n=null!==(a=null!==(t=null==i?void 0:i.content)&&void 0!==t?t:null==i?void 0:i.data)&&void 0!==a?a:i)&&void 0!==n?n:[];return Array.isArray(r)?r.map(e=>m(e)):[]},b=e=>{if(!e)return"";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})};function v(e){let{otherUserId:t,otherUserName:a,otherUserAvatar:i,currentUserId:l,currentUsername:h,onClose:m,title:v,subtitle:N,composerPlaceholder:f,channelId:g}=e,x=null==l?void 0:l.toString(),j=t?"".concat(d.CT,"/api/v1/nest/messages/").concat(encodeURIComponent(t)):null,{data:y,error:k,isValidating:w,mutate:C}=(0,r.ZP)(j,j?p:null,{refreshInterval:3e3,revalidateOnFocus:!1}),[M,T]=(0,s.useState)([]),[S,I]=(0,s.useState)(""),[P,B]=(0,s.useState)(!1),[H,F]=(0,s.useState)(""),[U,A]=(0,s.useState)(!1),W=(0,s.useRef)(null),D=(0,s.useRef)(null),[E,L]=(0,s.useState)(!1),O=!!g,R=g||"town-square";(0,s.useEffect)(()=>{W.current&&(W.current.scrollTop=W.current.scrollHeight)},[M.length,null==y?void 0:y.length]),(0,s.useEffect)(()=>{if(!O)return;let e=!1;return(async()=>{try{let t=await fetch("".concat(d.CT,"/api/v1/chat/history?channelId=").concat(encodeURIComponent(R)),{credentials:"include"});if(!t.ok)return;let a=await t.json();e||T(a.map(e=>({id:e.id,content:e.content,senderUsername:e.senderUsername,timestamp:e.timestamp})))}catch(e){console.warn("[Chat] Failed to load history",e)}})(),()=>{e=!0}},[O,R]),(0,s.useEffect)(()=>{if(!O){T([]),D.current&&(D.current.deactivate(),D.current=null);return}let e=new o.K({webSocketFactory:()=>new(c())("".concat(d.CT,"/ws-chat")),reconnectDelay:5e3,onConnect:()=>{L(!0),e.subscribe("/topic/".concat(R),e=>{try{let t=JSON.parse(e.body);T(e=>[...e,{id:t.id,content:t.content,senderUsername:t.senderUsername,timestamp:t.timestamp}])}catch(e){console.warn("[Chat] Failed to parse message",e)}})},onDisconnect:()=>L(!1),onStompError:()=>L(!1)});return D.current=e,e.activate(),()=>{L(!1),e.deactivate(),D.current=null}},[O,R]);let q=(0,s.useMemo)(()=>y?[...y].sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()):[],[y]),V=(0,s.useMemo)(()=>O?[]:q.map(e=>({id:e.id,content:e.body,senderUsername:e.senderId===x?h||"You":a||"Member",timestamp:e.createdAt,pending:e.pending,isMine:e.senderId===x})),[q,x,a,h,O]),Y=O?M:V,z=async e=>{if(e&&e.preventDefault(),!S.trim()||P)return;if(O){if(!E||!D.current){F("Chat is reconnecting. Hold on…");return}let e={channelId:R,content:S.trim(),senderUsername:h||"Guest"};B(!0),F(""),I(""),A(!1);try{D.current.publish({destination:"/app/chat.sendMessage",body:JSON.stringify(e)})}catch(e){console.error("[Chat] Failed to publish message",e),F("Unable to send message right now.")}finally{B(!1)}return}if(!j)return;B(!0);let a=S.trim(),n={id:"temp-".concat(Date.now(),"-").concat(Math.random()),senderId:null!=x?x:"me",senderName:"You",body:a,createdAt:new Date().toISOString(),pending:!0};C(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...e,n]},!1),I(""),F("");try{if(!(await fetch("".concat(d.CT,"/api/v1/nest/message"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({recipientId:t,body:a})})).ok)throw Error("Failed to send message");await C()}catch(e){C(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.id!==n.id)},!1),F("Unable to send message. Please try again."),console.error(e)}finally{B(!1)}},G=!!O||!!j,J=v||a||(O?"Town Square":"Choose a conversation"),K=N||(O?"Global chat":i?"Live chat":"Message nest user");return(0,n.jsxs)("div",{className:u().chatArea,children:[(0,n.jsxs)("div",{className:u().chatHeader,children:[m&&(0,n.jsx)("button",{type:"button",className:u().mobileBack,onClick:m,"aria-label":"Back to conversations",children:"←"}),(0,n.jsxs)("div",{className:u().chatHeaderInfo,children:[(0,n.jsx)("span",{className:u().chatUserName,children:J}),(0,n.jsx)("span",{className:u().chatSubtitle,children:K})]})]}),G?!O&&k?(0,n.jsx)("div",{className:u().chatPlaceholder,children:"Unable to load chat history."}):(0,n.jsxs)("div",{ref:W,className:u().chatMessages,children:[Y.map(e=>{let t=e.isMine||O&&e.senderUsername===(h||"Guest");return(0,n.jsx)("div",{className:u().chatMessageRow,children:(0,n.jsxs)("div",{className:"".concat(u().chatBubble," ").concat(t?u().chatBubbleMine:""," ").concat(e.pending?u().chatBubblePending:""),children:[(0,n.jsx)("strong",{children:e.senderUsername}),(0,n.jsx)("span",{children:e.content}),(0,n.jsxs)("small",{children:[b(e.timestamp)," ",e.pending?"• sending…":""]})]})},e.id)}),!Y.length&&(0,n.jsx)("p",{className:u().placeholder,children:O?"No chatter yet. Say hi!":"Loading messages…"})]}):(0,n.jsx)("div",{className:u().chatPlaceholder,children:"Select a conversation to open the chat."}),G&&(0,n.jsxs)("div",{className:u().chatFooter,children:[H&&(0,n.jsx)("p",{className:u().errorMessage,children:H}),(0,n.jsxs)("form",{className:u().chatForm,onSubmit:z,children:[(0,n.jsx)("textarea",{className:u().chatInput,placeholder:f||"Write a message…",value:S,onChange:e=>I(e.target.value),rows:2,style:{maxHeight:40,minHeight:40}}),(0,n.jsxs)("div",{className:u().emojiToggle,children:[(0,n.jsx)("button",{type:"button",onClick:()=>A(e=>!e),"aria-label":"Toggle emoji",children:"\uD83D\uDE42"}),U&&(0,n.jsx)("div",{className:u().emojiPicker,children:(0,n.jsx)(_,{onEmojiClick:e=>{I(t=>"".concat(t).concat(e.emoji))}})})]}),(0,n.jsx)("button",{type:"submit",className:"".concat(u().sendButton," ").concat(S.trim()&&!P?u().sendButtonActive:""),disabled:P||!S.trim(),children:(0,n.jsx)("svg",{viewBox:"0 0 24 24",width:"20",height:"20","aria-hidden":"true",children:(0,n.jsx)("path",{d:"M3.4 20.4 21 12 3.4 3.6 3 10l11 2-11 2z",fill:"currentColor"})})})]})]})]})}},1468:function(e){e.exports={footer:"Footer_footer__pQtti",links:"Footer_links__cFiYr",link:"Footer_link__TBOP7",right:"Footer_right__s6ko6",copy:"Footer_copy__KUC9W",socials:"Footer_socials__Arjjf",socialButton:"Footer_socialButton__owWdN"}},6914:function(e){e.exports={header:"MainHeader_header__v29oY",brand:"MainHeader_brand__PWSjn",nav:"MainHeader_nav__OWvbh",navLink:"MainHeader_navLink__NUd27",activeLink:"MainHeader_activeLink__YR7BN",actions:"MainHeader_actions__jUZ_j",coinWidget:"MainHeader_coinWidget__Lwamz",coinIcon:"MainHeader_coinIcon__GoTN_",coinText:"MainHeader_coinText__soICt",coinLabel:"MainHeader_coinLabel__rEQWV",coinValue:"MainHeader_coinValue__U9zIq",profileCircle:"MainHeader_profileCircle__654Xs",hamburger:"MainHeader_hamburger__9fVCh",mobileNav:"MainHeader_mobileNav__RVDMJ",mobileNavItem:"MainHeader_mobileNavItem__n0yAB"}},8950:function(e){e.exports={page:"Nest_page___yV6N",dark:"Nest_dark__CKKHW",main:"Nest_main__J5eEH",intro:"Nest_intro__smxCu",introTitle:"Nest_introTitle__Gcqx5",introSubtitle:"Nest_introSubtitle__pDsIe",layout:"Nest_layout__DxSWs",sidebar:"Nest_sidebar__MihBh",chatColumn:"Nest_chatColumn__8fTs3",chatArea:"Nest_chatArea__lUl5r",sidebarHeader:"Nest_sidebarHeader__C_5oE",sidebarTitle:"Nest_sidebarTitle__dbiti",sidebarSubtitle:"Nest_sidebarSubtitle__pjPWz",list:"Nest_list__FtO4A",conversationItem:"Nest_conversationItem__Rsx2F",conversationActive:"Nest_conversationActive__na1JN",conversationAvatar:"Nest_conversationAvatar__dWIWq",conversationContent:"Nest_conversationContent__7b0Nx",conversationTopRow:"Nest_conversationTopRow__KZuJm",conversationName:"Nest_conversationName__6LYt0",conversationTime:"Nest_conversationTime__vVk9x",conversationPreview:"Nest_conversationPreview__CpWPW",conversationBottomRow:"Nest_conversationBottomRow__TLyYi",unreadBadge:"Nest_unreadBadge__uIbje",chatHeader:"Nest_chatHeader__9T9om",chatHeaderInfo:"Nest_chatHeaderInfo__UrdYS",chatUserName:"Nest_chatUserName__5DTks",chatSubtitle:"Nest_chatSubtitle__Fu7_Y",mobileBack:"Nest_mobileBack__5afX4",chatMessages:"Nest_chatMessages__yigPb",chatMessageRow:"Nest_chatMessageRow__B_TMz",chatBubble:"Nest_chatBubble__kbvJa",chatBubbleMine:"Nest_chatBubbleMine__MbqWZ",chatBubblePending:"Nest_chatBubblePending__aqd_F",chatTimestamp:"Nest_chatTimestamp__5vTds",chatTimestampMine:"Nest_chatTimestampMine__e6RKz",chatFooter:"Nest_chatFooter__i3sQh",chatForm:"Nest_chatForm__5zIqr",chatInput:"Nest_chatInput__ad88Q",sendButton:"Nest_sendButton__sff9g",sendButtonActive:"Nest_sendButtonActive__mtVix",emojiToggle:"Nest_emojiToggle___qh_N",emojiPicker:"Nest_emojiPicker__oAw9o",chatPlaceholder:"Nest_chatPlaceholder__4hqtE",errorMessage:"Nest_errorMessage__SpWq1",placeholder:"Nest_placeholder__Ks3Eb",mobileHidden:"Nest_mobileHidden__r_6cE"}}}]);