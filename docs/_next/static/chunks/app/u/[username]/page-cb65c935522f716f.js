(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8977],{9092:function(e,a,t){Promise.resolve().then(t.bind(t,9304))},9304:function(e,a,t){"use strict";t.d(a,{default:function(){return M}});var r=t(7437),l=t(2265),n=t(1224),s=t(8349),i=t(4482),o=t.n(i);function c(e){let{bannerUrl:a,avatarUrl:t,name:n,username:s,bio:i,joinDate:c,followersCount:d=0,followingCount:u=0,patsReceived:_=0,isFollowing:h=!1,onToggleFollow:f}=e,[m,p]=(0,l.useState)(h),[b,v]=(0,l.useState)(!1),x=async()=>{if(b)return;let e=!m;p(e),v(!0);try{await f(e)}catch(a){p(!e)}finally{v(!1)}};return(0,r.jsxs)("section",{className:o().header,children:[(0,r.jsx)("div",{className:o().banner,children:a?(0,r.jsx)("img",{src:a,alt:"".concat(n," banner")}):null}),(0,r.jsx)("div",{className:o().avatarWrapper,children:t?(0,r.jsx)("img",{src:t,alt:"".concat(n," avatar")}):(0,r.jsx)("div",{className:o().avatarFallback,children:n[0]})}),(0,r.jsxs)("div",{className:o().meta,children:[(0,r.jsxs)("div",{className:o().flexRow,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{children:n}),(0,r.jsxs)("p",{className:o().handle,children:["@",s]})]}),(0,r.jsx)("button",{className:"".concat(o().followBtn," ").concat(m?o().following:""),onClick:x,disabled:b,children:m?"Following":"Follow"})]}),i&&(0,r.jsx)("p",{className:o().bio,children:i}),(0,r.jsx)("div",{className:o().date,children:c?"Joined ".concat(c):"Joined recently"}),(0,r.jsxs)("div",{className:o().statsRow,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:d.toLocaleString()}),(0,r.jsx)("p",{children:"Followers"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:u.toLocaleString()}),(0,r.jsx)("p",{children:"Following"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:_.toLocaleString()}),(0,r.jsx)("p",{children:"Pats Received"})]})]})]})]})}var d=t(5323),u=t(7996),_=t(8034),h=t(2827),f=t(2558);let m=()=>{},p=m(),b=Object,v=e=>e===p,x=e=>"function"==typeof e,g=new WeakMap,j=e=>b.prototype.toString.call(e),N=(e,a)=>e===`[object ${a}]`,y=0,k=e=>{let a,t;let r=typeof e,l=j(e),n=N(l,"Date"),s=N(l,"RegExp"),i=N(l,"Object");if(b(e)!==e||n||s)a=n?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(a=g.get(e))return a;if(a=++y+"~",g.set(e,a),Array.isArray(e)){for(t=0,a="@";t<e.length;t++)a+=k(e[t])+",";g.set(e,a)}if(i){a="#";let r=b.keys(e).sort();for(;!v(t=r.pop());)v(e[t])||(a+=t+":"+k(e[t])+",");g.set(e,a)}}return a},w=e=>{if(x(e))try{e=e()}catch(a){e=""}let a=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?k(e):"",a]},C=e=>w(e?e(0,null):null)[0],P=Promise.resolve(),L=(0,h.xD)(d.ZP,e=>(a,t,r)=>{let n;let s=(0,l.useRef)(!1),{cache:i,initialSize:o=1,revalidateAll:c=!1,persistSize:d=!1,revalidateFirstPage:h=!0,revalidateOnMount:m=!1,parallel:p=!1}=r,[,,,b]=u.b.get(u.c);try{(n=C(a))&&(n=_.U+n)}catch(e){}let[v,x,g]=(0,u.z)(i,n),j=(0,l.useCallback)(()=>(0,u.e)(v()._l)?o:v()._l,[i,n,o]);(0,f.useSyncExternalStore)((0,l.useCallback)(e=>n?g(n,()=>{e()}):()=>{},[i,n]),j,j);let N=(0,l.useCallback)(()=>{let e=v()._l;return(0,u.e)(e)?o:e},[n,o]),y=(0,l.useRef)(N());(0,u.u)(()=>{if(!s.current){s.current=!0;return}n&&x({_l:d?y.current:N()})},[n,i]);let k=m&&!s.current,w=e(n,async e=>{let l=v()._i,n=v()._r;x({_r:u.U});let s=[],o=N(),[d]=(0,u.z)(i,e),_=d().data,f=[],m=null;for(let e=0;e<o;++e){let[o,d]=(0,u.s)(a(e,p?null:m));if(!o)break;let[v,x]=(0,u.z)(i,o),g=v().data,j=c||l||(0,u.e)(g)||h&&!e&&!(0,u.e)(_)||k||_&&!(0,u.e)(_[e])&&!r.compare(_[e],g);if(t&&("function"==typeof n?n(g,d):j)){let a=async()=>{if(o in b){let e=b[o];delete b[o],g=await e}else g=await t(d);x({data:g,_k:d}),s[e]=g};p?f.push(a):await a()}else s[e]=g;p||(m=g)}return p&&await Promise.all(f.map(e=>e())),x({_i:u.U}),s},r),L=(0,l.useCallback)(function(e,a){let t="boolean"==typeof a?{revalidate:a}:a||{},r=!1!==t.revalidate;return n?(r&&((0,u.e)(e)?x({_i:!0,_r:t.revalidate}):x({_i:!1,_r:t.revalidate})),arguments.length?w.mutate(e,{...t,revalidate:r}):w.mutate()):P},[n,i]),U=(0,l.useCallback)(e=>{let t;if(!n)return P;let[,r]=(0,u.z)(i,n);if((0,u.a)(e)?t=e(N()):"number"==typeof e&&(t=e),"number"!=typeof t)return P;r({_l:t}),y.current=t;let l=[],[s]=(0,u.z)(i,n),o=null;for(let e=0;e<t;++e){let[t]=(0,u.s)(a(e,o)),[r]=(0,u.z)(i,t),n=t?r().data:u.U;if((0,u.e)(n))return L(s().data);l.push(n),o=n}return L(l)},[n,i,L,N]);return{size:N(),setSize:U,mutate:L,get data(){return w.data},get error(){return w.error},get isValidating(){return w.isValidating},get isLoading(){return w.isLoading}}});var U=t(6140);let F=e=>fetch(e).then(e=>{if(!e.ok)throw Error("Failed to load feed page");return e.json()});function S(e){let{fetchUrl:a,queryKey:t,requiresAuth:n=!1,onAuthWall:s}=e,{data:i,size:o,setSize:c,error:d,isValidating:u}=L((e,r)=>r&&0===r.content.length?null:[t,"".concat(a).concat(a.includes("?")?"&":"?","page=").concat(e,"&size=").concat(10)],F,{revalidateFirstPage:!1}),_=(0,l.useMemo)(()=>{var e;return null!==(e=null==i?void 0:i.flatMap(e=>(null==e?void 0:e.content)||[]))&&void 0!==e?e:[]},[i]),h=!i&&!d,f=u&&o>0,m=i&&i[i.length-1]&&i[i.length-1].content.length<10,p=(0,l.useRef)(null),b=(0,l.useRef)(null);return((0,l.useEffect)(()=>{var e;if(b.current)return null===(e=p.current)||void 0===e||e.disconnect(),p.current=new IntersectionObserver(e=>{!e[0].isIntersecting||f||m||c(e=>e+1)},{rootMargin:"200px"}),p.current.observe(b.current),()=>{var e;null===(e=p.current)||void 0===e||e.disconnect()}},[f,m,c,o]),d)?(0,r.jsx)("p",{style:{color:"#ef4444"},children:"Unable to load content."}):h?(0,r.jsx)("p",{children:"Loading stories…"}):(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[_.map(e=>{var a;return(0,r.jsx)(U.Z,{title:e.title,summary:e.excerpt||e.body,source:e.source||e.categoryName,createdAt:e.createdAt||e.publishedAt,patCount:null!==(a=e.patCount)&&void 0!==a?a:0,thumbnailUrl:e.authorAvatarUrl||e.avatarUrl,isPattedByCurrentUser:e.hasPatted,requiresAuth:n,onAuthWall:s},e.id)}),(0,r.jsx)("div",{ref:b}),f&&(0,r.jsx)("p",{children:"Loading more…"}),m&&_.length>0&&(0,r.jsx)("p",{style:{color:"#6b7280"},children:"You’ve reached the latest posts."})]})}var E=t(7029),H=t(9799),D=t.n(H);let A=[{key:"curated",label:"Curated Feeds",endpoint:"feeds?tab=curated"},{key:"pats",label:"Pats",endpoint:"pats"},{key:"comments",label:"Comments",endpoint:"comments"}];function M(e){var a,t,i;let{params:o}=e,d=null==o?void 0:o.username,[u,_]=(0,l.useState)(null),[h,f]=(0,l.useState)(!0),[m,p]=(0,l.useState)(""),[b,v]=(0,l.useState)(A[0].key);(0,l.useEffect)(()=>{if(!d)return;let e=!1;return f(!0),p(""),(0,E.Zm)(d).then(a=>{if(!e){if(!a){p("User not found");return}_(a)}}).catch(a=>{e||(console.warn("[Profile] failed to load profile",a),p("Unable to load profile"))}).finally(()=>{e||f(!1)}),()=>{e=!0}},[d]);let x=async e=>{if(!d)throw Error("Username unavailable");if(!(await fetch("/api/v1/users/".concat(d,"/").concat(e?"follow":"unfollow"),{method:e?"POST":"DELETE",credentials:"include"})).ok)throw Error("Failed to update follow status")},g=null==u?void 0:u.bannerUrl,j=(null==u?void 0:u.createdAt)?new Date(u.createdAt).toLocaleDateString(void 0,{month:"short",year:"numeric"}):void 0,N=(0,l.useMemo)(()=>{let e=A.find(e=>e.key===b);return e&&d?"/api/v1/users/".concat(d,"/").concat(e.endpoint):""},[b,d]);return d?(0,r.jsxs)("div",{className:D().page,children:[(0,r.jsx)(n.Z,{}),(0,r.jsxs)("main",{className:D().main,children:[h&&(0,r.jsx)("div",{className:D().bannerLoading,children:"Loading profile…"}),m&&(0,r.jsx)("div",{className:D().bannerError,children:m}),!h&&u&&(0,r.jsx)(c,{bannerUrl:g,avatarUrl:u.avatarUrl,name:u.fullName||u.name||u.username||"Patreek User",username:u.username||d,bio:u.bio||u.headline,joinDate:j,followersCount:null!==(a=u.followersCount)&&void 0!==a?a:0,followingCount:null!==(t=u.followingCount)&&void 0!==t?t:0,patsReceived:null!==(i=u.totalPats)&&void 0!==i?i:0,isFollowing:u.isFollowing,onToggleFollow:x}),(0,r.jsx)("div",{className:D().tabs,children:A.map(e=>(0,r.jsx)("button",{className:"".concat(D().tab," ").concat(b===e.key?D().tabActive:""),onClick:()=>v(e.key),type:"button",children:e.label},e.key))}),N&&(0,r.jsx)("div",{className:D().feedArea,children:(0,r.jsx)(S,{fetchUrl:N,queryKey:"".concat(d,"-").concat(b)})})]}),(0,r.jsx)(s.Z,{})]}):null}},8349:function(e,a,t){"use strict";t.d(a,{Z:function(){return c}});var r=t(7437),l=t(7648),n=t(1468),s=t.n(n);let i=[{label:"Privacy",href:"/privacy"},{label:"Terms",href:"/terms"},{label:"Help",href:"/help"},{label:"About",href:"/about"}],o=[{label:"X",href:"https://x.com/patreek",aria:"Open Patreek on X"},{label:"Facebook",href:"https://facebook.com",aria:"Open Patreek on Facebook"},{label:"Instagram",href:"https://instagram.com",aria:"Open Patreek on Instagram"}];function c(){let e=new Date().getFullYear();return(0,r.jsxs)("footer",{className:s().footer,children:[(0,r.jsx)("div",{className:s().links,children:i.map(e=>(0,r.jsx)(l.default,{href:e.href,className:s().link,children:e.label},e.label))}),(0,r.jsxs)("div",{className:s().right,children:[(0,r.jsxs)("span",{className:s().copy,children:["\xa9 ",e," Patreek"]}),(0,r.jsx)("div",{className:s().socials,children:o.map(e=>(0,r.jsx)("a",{href:e.href,target:"_blank",rel:"noopener noreferrer","aria-label":e.aria,className:s().socialButton,children:"X"===e.label?"X":e.label.charAt(0)},e.label))})]})]})}},1224:function(e,a,t){"use strict";t.d(a,{Z:function(){return d}});var r=t(7437),l=t(2265),n=t(7648),s=t(9376),i=t(6914),o=t.n(i),c=t(7029);function d(e){let{hasSession:a=!1,active:t}=e,i=(0,s.useRouter)(),d=(0,s.usePathname)(),[u,_]=(0,l.useState)(null),[h,f]=(0,l.useState)(!1),m=(0,l.useMemo)(()=>null==t?void 0:t.toLowerCase(),[t]),p=[{label:"Coins",path:"/coins"},{label:"Community",path:"/community"},{label:"Shop",path:"https://shop.patreek.com"},{label:"Opinion",path:"/opinion"},{label:"Write",path:"/write"}];(0,l.useEffect)(()=>{(async()=>{if(a)try{if(!(await (0,c.r$)()).authenticated)return;let e=await (0,c.getUserProfile)();(null==e?void 0:e.username)&&_(e.username)}catch(e){_(null)}})()},[a]);let b=e=>!!(m&&m===e.label.toLowerCase()||d&&e.path.startsWith("/")&&d.startsWith(e.path));return(0,r.jsxs)("header",{className:o().header,children:[(0,r.jsx)("div",{className:o().brand,onClick:()=>i.push("/"),children:"Patreek"}),(0,r.jsx)("nav",{className:o().nav,children:p.map(e=>(0,r.jsx)(n.default,{href:e.path,className:"".concat(o().navLink," ").concat(b(e)?o().activeLink:""),target:e.path.startsWith("http")?"_blank":void 0,children:e.label},e.label))}),(0,r.jsxs)("div",{className:o().actions,children:[(0,r.jsx)("button",{type:"button",className:o().iconButton,"aria-label":"Search Patreek",children:"\uD83D\uDD0D"}),(0,r.jsx)("button",{type:"button",className:o().profileCircle,onClick:()=>{a&&u?i.push("/u/".concat(u)):i.push("/registration")},"aria-label":"Open profile",children:u?u[0].toUpperCase():"P"}),(0,r.jsxs)("button",{type:"button",className:o().hamburger,onClick:()=>f(e=>!e),"aria-label":"Toggle navigation",children:[(0,r.jsx)("span",{}),(0,r.jsx)("span",{}),(0,r.jsx)("span",{})]})]}),h&&(0,r.jsx)("div",{className:o().mobileNav,children:p.map(e=>(0,r.jsx)(n.default,{href:e.path,className:o().mobileNavItem,onClick:()=>f(!1),children:e.label},e.label))})]})}},6140:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var r=t(7437),l=t(2265),n=t(5561),s=t.n(n);function i(e){let{title:a,summary:t,source:n,createdAt:i,patCount:o,thumbnailUrl:c,isPattedByCurrentUser:d=!1,requiresAuth:u=!1,onAuthWall:_}=e,[h,f]=(0,l.useState)(!!d),[m,p]=(0,l.useState)(o);(0,l.useEffect)(()=>{p(o)},[o]),(0,l.useEffect)(()=>{f(!!d)},[d]);let b=(0,l.useMemo)(()=>{let e=new Date(i);return Number.isNaN(e.getTime())?i:e.toLocaleDateString(void 0,{month:"short",day:"numeric"})},[i]);return(0,r.jsxs)("article",{className:s().card,children:[(0,r.jsx)("div",{className:s().thumbnail,children:c?(0,r.jsx)("img",{src:c,alt:"",loading:"lazy"}):(0,r.jsx)("span",{className:s().fallback,children:"Patreek"})}),(0,r.jsxs)("div",{className:s().body,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:s().title,children:a}),t&&(0,r.jsx)("p",{className:s().summary,children:t})]}),(0,r.jsxs)("div",{className:s().meta,children:[n&&(0,r.jsx)("span",{className:s().source,children:n}),(0,r.jsx)("span",{className:s().date,children:b})]})]}),(0,r.jsxs)("button",{className:"".concat(s().patButton," ").concat(h?s().active:""),onClick:()=>{if(u&&_){_("pat this story");return}f(e=>{let a=!e;return p(e=>Math.max(0,e+(a?1:-1))),a})},"aria-pressed":h,type:"button",children:[(0,r.jsx)("span",{className:s().emoji,children:h?"\uD83E\uDDE1":"\uD83E\uDD0D"}),(0,r.jsx)("span",{children:null!=m?m:0})]})]})}},9799:function(e){e.exports={page:"page_page__bc9x8",main:"page_main__NKoTg",bannerLoading:"page_bannerLoading__bk8_3",bannerError:"page_bannerError__8_WKb",tabs:"page_tabs__peiXs",tab:"page_tab__uQJ_s",tabActive:"page_tabActive__LVwKc",feedArea:"page_feedArea__eeevP"}},1468:function(e){e.exports={footer:"Footer_footer__pQtti",links:"Footer_links__cFiYr",link:"Footer_link__TBOP7",right:"Footer_right__s6ko6",copy:"Footer_copy__KUC9W",socials:"Footer_socials__Arjjf",socialButton:"Footer_socialButton__owWdN"}},6914:function(e){e.exports={header:"MainHeader_header__v29oY",brand:"MainHeader_brand__PWSjn",nav:"MainHeader_nav__OWvbh",navLink:"MainHeader_navLink__NUd27",activeLink:"MainHeader_activeLink__YR7BN",actions:"MainHeader_actions__jUZ_j",iconButton:"MainHeader_iconButton__6RFhG",profileCircle:"MainHeader_profileCircle__654Xs",hamburger:"MainHeader_hamburger__9fVCh",mobileNav:"MainHeader_mobileNav__RVDMJ",mobileNavItem:"MainHeader_mobileNavItem__n0yAB"}},5561:function(e){e.exports={card:"NewsCard_card__Bm9sO",thumbnail:"NewsCard_thumbnail__BAIOz",fallback:"NewsCard_fallback__0OCyu",body:"NewsCard_body__OdhJz",title:"NewsCard_title__WyhML",summary:"NewsCard_summary__EYmvD",meta:"NewsCard_meta__7xLcK",source:"NewsCard_source___WCHw",date:"NewsCard_date__tt3Qu",patButton:"NewsCard_patButton__NBU4h",emoji:"NewsCard_emoji__SUdPj",active:"NewsCard_active__yE_Gf"}},4482:function(e){e.exports={header:"ProfileHeader_header__g5kUM",banner:"ProfileHeader_banner__Edbjm",avatarWrapper:"ProfileHeader_avatarWrapper__K_duL",avatarFallback:"ProfileHeader_avatarFallback__LuCn4",meta:"ProfileHeader_meta__U5wn_",flexRow:"ProfileHeader_flexRow__JbUlk",handle:"ProfileHeader_handle__Tgfeg",bio:"ProfileHeader_bio__6Y4vv",date:"ProfileHeader_date__kQPnO",statsRow:"ProfileHeader_statsRow__g3e5L",followBtn:"ProfileHeader_followBtn__wQY_g",following:"ProfileHeader_following__4NyFh"}}},function(e){e.O(0,[7123,9845,1467,2972,3767,7029,2971,2117,1744],function(){return e(e.s=9092)}),_N_E=e.O()}]);