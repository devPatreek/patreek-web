(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8977],{9092:function(e,t,a){Promise.resolve().then(a.bind(a,9658))},9658:function(e,t,a){"use strict";a.d(t,{default:function(){return D}});var r=a(7437),n=a(2265),l=a(1224),i=a(8349),s=a(4482),o=a.n(s);function c(e){let{bannerUrl:t,avatarUrl:a,name:l,username:i,bio:s,joinDate:c,followersCount:u=0,followingCount:d=0,patsReceived:h=0,isFollowing:f=!1,onToggleFollow:_}=e,[m,p]=(0,n.useState)(f),[b,v]=(0,n.useState)(!1),g=async()=>{if(b)return;let e=!m;p(e),v(!0);try{await _(e)}catch(t){p(!e)}finally{v(!1)}};return(0,r.jsxs)("section",{className:o().header,children:[(0,r.jsx)("div",{className:o().banner,children:t?(0,r.jsx)("img",{src:t,alt:"".concat(l," banner")}):null}),(0,r.jsx)("div",{className:o().avatarWrapper,children:a?(0,r.jsx)("img",{src:a,alt:"".concat(l," avatar")}):(0,r.jsx)("div",{className:o().avatarFallback,children:l[0]})}),(0,r.jsxs)("div",{className:o().meta,children:[(0,r.jsxs)("div",{className:o().flexRow,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{children:l}),(0,r.jsxs)("p",{className:o().handle,children:["@",i]})]}),(0,r.jsx)("button",{className:"".concat(o().followBtn," ").concat(m?o().following:""),onClick:g,disabled:b,children:m?"Following":"Follow"})]}),s&&(0,r.jsx)("p",{className:o().bio,children:s}),(0,r.jsx)("div",{className:o().date,children:c?"Joined ".concat(c):"Joined recently"}),(0,r.jsxs)("div",{className:o().statsRow,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:u.toLocaleString()}),(0,r.jsx)("p",{children:"Followers"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:d.toLocaleString()}),(0,r.jsx)("p",{children:"Following"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{children:h.toLocaleString()}),(0,r.jsx)("p",{children:"Pats Received"})]})]})]})]})}var u=a(5323),d=a(7996),h=a(8034),f=a(2827),_=a(2558);let m=()=>{},p=m(),b=Object,v=e=>e===p,g=e=>"function"==typeof e,x=new WeakMap,j=e=>b.prototype.toString.call(e),y=(e,t)=>e===`[object ${t}]`,N=0,w=e=>{let t,a;let r=typeof e,n=j(e),l=y(n,"Date"),i=y(n,"RegExp"),s=y(n,"Object");if(b(e)!==e||l||i)t=l?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(t=x.get(e))return t;if(t=++N+"~",x.set(e,t),Array.isArray(e)){for(a=0,t="@";a<e.length;a++)t+=w(e[a])+",";x.set(e,t)}if(s){t="#";let r=b.keys(e).sort();for(;!v(a=r.pop());)v(e[a])||(t+=a+":"+w(e[a])+",");x.set(e,t)}}return t},k=e=>{if(g(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?w(e):"",t]},C=e=>k(e?e(0,null):null)[0],P=Promise.resolve(),L=(0,f.xD)(u.ZP,e=>(t,a,r)=>{let l;let i=(0,n.useRef)(!1),{cache:s,initialSize:o=1,revalidateAll:c=!1,persistSize:u=!1,revalidateFirstPage:f=!0,revalidateOnMount:m=!1,parallel:p=!1}=r,[,,,b]=d.b.get(d.c);try{(l=C(t))&&(l=h.U+l)}catch(e){}let[v,g,x]=(0,d.z)(s,l),j=(0,n.useCallback)(()=>(0,d.e)(v()._l)?o:v()._l,[s,l,o]);(0,_.useSyncExternalStore)((0,n.useCallback)(e=>l?x(l,()=>{e()}):()=>{},[s,l]),j,j);let y=(0,n.useCallback)(()=>{let e=v()._l;return(0,d.e)(e)?o:e},[l,o]),N=(0,n.useRef)(y());(0,d.u)(()=>{if(!i.current){i.current=!0;return}l&&g({_l:u?N.current:y()})},[l,s]);let w=m&&!i.current,k=e(l,async e=>{let n=v()._i,l=v()._r;g({_r:d.U});let i=[],o=y(),[u]=(0,d.z)(s,e),h=u().data,_=[],m=null;for(let e=0;e<o;++e){let[o,u]=(0,d.s)(t(e,p?null:m));if(!o)break;let[v,g]=(0,d.z)(s,o),x=v().data,j=c||n||(0,d.e)(x)||f&&!e&&!(0,d.e)(h)||w||h&&!(0,d.e)(h[e])&&!r.compare(h[e],x);if(a&&("function"==typeof l?l(x,u):j)){let t=async()=>{if(o in b){let e=b[o];delete b[o],x=await e}else x=await a(u);g({data:x,_k:u}),i[e]=x};p?_.push(t):await t()}else i[e]=x;p||(m=x)}return p&&await Promise.all(_.map(e=>e())),g({_i:d.U}),i},r),L=(0,n.useCallback)(function(e,t){let a="boolean"==typeof t?{revalidate:t}:t||{},r=!1!==a.revalidate;return l?(r&&((0,d.e)(e)?g({_i:!0,_r:a.revalidate}):g({_i:!1,_r:a.revalidate})),arguments.length?k.mutate(e,{...a,revalidate:r}):k.mutate()):P},[l,s]),U=(0,n.useCallback)(e=>{let a;if(!l)return P;let[,r]=(0,d.z)(s,l);if((0,d.a)(e)?a=e(y()):"number"==typeof e&&(a=e),"number"!=typeof a)return P;r({_l:a}),N.current=a;let n=[],[i]=(0,d.z)(s,l),o=null;for(let e=0;e<a;++e){let[a]=(0,d.s)(t(e,o)),[r]=(0,d.z)(s,a),l=a?r().data:d.U;if((0,d.e)(l))return L(i().data);n.push(l),o=l}return L(n)},[l,s,L,y]);return{size:y(),setSize:U,mutate:L,get data(){return k.data},get error(){return k.error},get isValidating(){return k.isValidating},get isLoading(){return k.isLoading}}});var U=a(6140);let E=e=>fetch(e).then(e=>{if(!e.ok)throw Error("Failed to load feed page");return e.json()});function S(e){let{fetchUrl:t,queryKey:a,requiresAuth:l=!1,onAuthWall:i}=e,{data:s,size:o,setSize:c,error:u,isValidating:d}=L((e,r)=>r&&0===r.content.length?null:[a,"".concat(t).concat(t.includes("?")?"&":"?","page=").concat(e,"&size=").concat(10)],E,{dedupingInterval:6e5,revalidateOnFocus:!1,revalidateFirstPage:!1}),h=(0,n.useMemo)(()=>{var e;return null!==(e=null==s?void 0:s.flatMap(e=>(null==e?void 0:e.content)||[]))&&void 0!==e?e:[]},[s]),f=!s&&!u,_=d&&o>0,m=s&&s[s.length-1]&&s[s.length-1].content.length<10,p=(0,n.useRef)(null),b=(0,n.useRef)(null);return((0,n.useEffect)(()=>{var e;if(b.current)return null===(e=p.current)||void 0===e||e.disconnect(),p.current=new IntersectionObserver(e=>{!e[0].isIntersecting||_||m||c(e=>e+1)},{rootMargin:"200px"}),p.current.observe(b.current),()=>{var e;null===(e=p.current)||void 0===e||e.disconnect()}},[_,m,c,o]),u)?(0,r.jsx)("p",{style:{color:"#ef4444"},children:"Unable to load content."}):f?(0,r.jsx)("p",{children:"Loading stories…"}):(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[h.map(e=>{var t;return(0,r.jsx)(U.Z,{title:e.title,summary:e.excerpt||e.body,source:e.source||e.categoryName,createdAt:e.createdAt||e.publishedAt,patCount:null!==(t=e.patCount)&&void 0!==t?t:0,thumbnailUrl:e.imageUrl||e.articleImageUrl||e.authorAvatarUrl||e.avatarUrl,isPattedByCurrentUser:e.hasPatted,requiresAuth:l,onAuthWall:i},e.id)}),(0,r.jsx)("div",{ref:b}),_&&(0,r.jsx)("p",{children:"Loading more…"}),m&&h.length>0&&(0,r.jsx)("p",{style:{color:"#6b7280"},children:"You’ve reached the latest posts."})]})}var F=a(7029),T=a(9799),A=a.n(T);let H=[{key:"curated",label:"Curated Feeds",endpoint:"feeds?tab=curated"},{key:"pats",label:"Pats",endpoint:"pats"},{key:"comments",label:"Comments",endpoint:"comments"}];function D(e){var t,a,s;let{params:o}=e,u=null==o?void 0:o.username,[d,h]=(0,n.useState)(null),[f,_]=(0,n.useState)(!0),[m,p]=(0,n.useState)(""),[b,v]=(0,n.useState)(H[0].key);(0,n.useEffect)(()=>{if(!u)return;let e=!1;return _(!0),p(""),(0,F.Zm)(u).then(t=>{if(!e){if(!t){p("User not found");return}h(t)}}).catch(t=>{e||(console.warn("[Profile] failed to load profile",t),p("Unable to load profile"))}).finally(()=>{e||_(!1)}),()=>{e=!0}},[u]);let g=async e=>{if(!u)throw Error("Username unavailable");if(!(await fetch("/api/v1/users/".concat(u,"/").concat(e?"follow":"unfollow"),{method:e?"POST":"DELETE",credentials:"include"})).ok)throw Error("Failed to update follow status")},x=null==d?void 0:d.bannerUrl,j=(null==d?void 0:d.createdAt)?new Date(d.createdAt).toLocaleDateString(void 0,{month:"short",year:"numeric"}):void 0,y=(0,n.useMemo)(()=>{let e=H.find(e=>e.key===b);return e&&u?"/api/v1/users/".concat(u,"/").concat(e.endpoint):""},[b,u]);return u?(0,r.jsxs)("div",{className:A().page,children:[(0,r.jsx)(l.Z,{}),(0,r.jsxs)("main",{className:A().main,children:[f&&(0,r.jsx)("div",{className:A().bannerLoading,children:"Loading profile…"}),m&&(0,r.jsx)("div",{className:A().bannerError,children:m}),!f&&d&&(0,r.jsx)(c,{bannerUrl:x,avatarUrl:d.avatarUrl,name:d.fullName||d.name||d.username||"Patreek User",username:d.username||u,bio:d.bio||d.headline,joinDate:j,followersCount:null!==(t=d.followersCount)&&void 0!==t?t:0,followingCount:null!==(a=d.followingCount)&&void 0!==a?a:0,patsReceived:null!==(s=d.totalPats)&&void 0!==s?s:0,isFollowing:d.isFollowing,onToggleFollow:g}),(0,r.jsx)("div",{className:A().tabs,children:H.map(e=>(0,r.jsx)("button",{className:"".concat(A().tab," ").concat(b===e.key?A().tabActive:""),onClick:()=>v(e.key),type:"button",children:e.label},e.key))}),y&&(0,r.jsx)("div",{className:A().feedArea,children:(0,r.jsx)(S,{fetchUrl:y,queryKey:"".concat(u,"-").concat(b)})})]}),(0,r.jsx)(i.Z,{})]}):null}},8349:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var r=a(7437),n=a(7648),l=a(1468),i=a.n(l);let s=[{label:"Privacy",href:"/privacy"},{label:"Terms",href:"/terms"},{label:"Help",href:"/help"},{label:"About",href:"/about"}],o=[{label:"X",href:"https://x.com/patreek",aria:"Open Patreek on X"},{label:"Facebook",href:"https://facebook.com",aria:"Open Patreek on Facebook"},{label:"Instagram",href:"https://instagram.com",aria:"Open Patreek on Instagram"}];function c(){let e=new Date().getFullYear();return(0,r.jsxs)("footer",{className:i().footer,children:[(0,r.jsx)("div",{className:i().links,children:s.map(e=>(0,r.jsx)(n.default,{href:e.href,className:i().link,children:e.label},e.label))}),(0,r.jsxs)("div",{className:i().right,children:[(0,r.jsxs)("span",{className:i().copy,children:["\xa9 ",e," Patreek"]}),(0,r.jsx)("div",{className:i().socials,children:o.map(e=>(0,r.jsx)("a",{href:e.href,target:"_blank",rel:"noopener noreferrer","aria-label":e.aria,className:i().socialButton,children:"X"===e.label?"X":e.label.charAt(0)},e.label))})]})]})}},1224:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var r=a(7437),n=a(2265),l=a(7648),i=a(9376),s=a(6914),o=a.n(s),c=a(7029);function u(e){let{hasSession:t=!1,active:a}=e,s=(0,i.useRouter)(),u=(0,i.usePathname)(),[d,h]=(0,n.useState)(null),[f,_]=(0,n.useState)(!1),m=(0,n.useMemo)(()=>null==a?void 0:a.toLowerCase(),[a]),p=[{label:"Coins",path:"/coins"},{label:"Community",path:"/community"},{label:"Shop",path:"https://shop.patreek.com"},{label:"Opinion",path:"/opinion"},{label:"Write",path:"/write"}];(0,n.useEffect)(()=>{(async()=>{if(t)try{if(!(await (0,c.r$)()).authenticated)return;let e=await (0,c.getUserProfile)();(null==e?void 0:e.username)&&h(e.username)}catch(e){h(null)}})()},[t]);let b=e=>!!(m&&m===e.label.toLowerCase()||u&&e.path.startsWith("/")&&u.startsWith(e.path));return(0,r.jsxs)("header",{className:o().header,children:[(0,r.jsx)("div",{className:o().brand,onClick:()=>s.push("/"),children:"Patreek"}),(0,r.jsx)("nav",{className:o().nav,children:p.map(e=>(0,r.jsx)(l.default,{href:e.path,className:"".concat(o().navLink," ").concat(b(e)?o().activeLink:""),target:e.path.startsWith("http")?"_blank":void 0,children:e.label},e.label))}),(0,r.jsxs)("div",{className:o().actions,children:[(0,r.jsx)("button",{type:"button",className:o().iconButton,"aria-label":"Search Patreek",children:"\uD83D\uDD0D"}),(0,r.jsx)("button",{type:"button",className:o().profileCircle,onClick:()=>{t&&d?s.push("/u/".concat(d)):s.push("/registration")},"aria-label":"Open profile",children:d?d[0].toUpperCase():"P"}),(0,r.jsxs)("button",{type:"button",className:o().hamburger,onClick:()=>_(e=>!e),"aria-label":"Toggle navigation",children:[(0,r.jsx)("span",{}),(0,r.jsx)("span",{}),(0,r.jsx)("span",{})]})]}),f&&(0,r.jsx)("div",{className:o().mobileNav,children:p.map(e=>(0,r.jsx)(l.default,{href:e.path,className:o().mobileNavItem,onClick:()=>_(!1),children:e.label},e.label))})]})}},6140:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(7437),n=a(2265),l=a(5561),i=a.n(l);function s(e){let{title:t,summary:a,source:l,createdAt:s,patCount:o,thumbnailUrl:c,isPattedByCurrentUser:u=!1,requiresAuth:d=!1,onAuthWall:h}=e,[f,_]=(0,n.useState)(!!u),[m,p]=(0,n.useState)(o);(0,n.useEffect)(()=>{p(o)},[o]),(0,n.useEffect)(()=>{_(!!u)},[u]);let b=(0,n.useMemo)(()=>{let e=new Date(s);return Number.isNaN(e.getTime())?s:e.toLocaleDateString(void 0,{month:"short",day:"numeric"})},[s]);return(0,r.jsxs)("article",{className:i().card,children:[(0,r.jsx)("div",{className:i().thumbnail,children:c?(0,r.jsx)("img",{src:c,alt:"",loading:"lazy"}):(0,r.jsx)("span",{className:i().fallback,children:"Patreek"})}),(0,r.jsxs)("div",{className:i().body,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:i().title,children:t}),a&&(0,r.jsx)("p",{className:i().summary,children:a})]}),(0,r.jsxs)("div",{className:i().meta,children:[l&&(0,r.jsx)("span",{className:i().source,children:l}),(0,r.jsx)("span",{className:i().date,children:b})]})]}),(0,r.jsxs)("button",{className:"".concat(i().patButton," ").concat(f?i().active:""),onClick:()=>{if(d&&h){h("pat this story");return}_(e=>{let t=!e;return p(e=>Math.max(0,e+(t?1:-1))),t})},"aria-pressed":f,type:"button",children:[(0,r.jsx)("span",{className:i().emoji,children:f?"\uD83E\uDDE1":"\uD83E\uDD0D"}),(0,r.jsx)("span",{children:null!=m?m:0})]})]})}},9376:function(e,t,a){"use strict";var r=a(5475);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},257:function(e,t,a){"use strict";var r,n;e.exports=(null==(r=a.g.process)?void 0:r.env)&&"object"==typeof(null==(n=a.g.process)?void 0:n.env)?a.g.process:a(4227)},4227:function(e){!function(){var t={229:function(e){var t,a,r,n=e.exports={};function l(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var o=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?o=r.concat(o):u=-1,o.length&&h())}function h(){if(!c){var e=s(d);c=!0;for(var t=o.length;t;){for(r=o,o=[];++u<t;)r&&r[u].run();u=-1,t=o.length}r=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function _(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];o.push(new f(e,t)),1!==o.length||c||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=_,n.addListener=_,n.once=_,n.off=_,n.removeListener=_,n.removeAllListeners=_,n.emit=_,n.prependListener=_,n.prependOnceListener=_,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},a={};function r(e){var n=a[e];if(void 0!==n)return n.exports;var l=a[e]={exports:{}},i=!0;try{t[e](l,l.exports,r),i=!1}finally{i&&delete a[e]}return l.exports}r.ab="//";var n=r(229);e.exports=n}()},9799:function(e){e.exports={page:"page_page__bc9x8",main:"page_main__NKoTg",bannerLoading:"page_bannerLoading__bk8_3",bannerError:"page_bannerError__8_WKb",tabs:"page_tabs__peiXs",tab:"page_tab__uQJ_s",tabActive:"page_tabActive__LVwKc",feedArea:"page_feedArea__eeevP"}},1468:function(e){e.exports={footer:"Footer_footer__pQtti",links:"Footer_links__cFiYr",link:"Footer_link__TBOP7",right:"Footer_right__s6ko6",copy:"Footer_copy__KUC9W",socials:"Footer_socials__Arjjf",socialButton:"Footer_socialButton__owWdN"}},6914:function(e){e.exports={header:"MainHeader_header__v29oY",brand:"MainHeader_brand__PWSjn",nav:"MainHeader_nav__OWvbh",navLink:"MainHeader_navLink__NUd27",activeLink:"MainHeader_activeLink__YR7BN",actions:"MainHeader_actions__jUZ_j",iconButton:"MainHeader_iconButton__6RFhG",profileCircle:"MainHeader_profileCircle__654Xs",hamburger:"MainHeader_hamburger__9fVCh",mobileNav:"MainHeader_mobileNav__RVDMJ",mobileNavItem:"MainHeader_mobileNavItem__n0yAB"}},5561:function(e){e.exports={card:"NewsCard_card__Bm9sO",thumbnail:"NewsCard_thumbnail__BAIOz",fallback:"NewsCard_fallback__0OCyu",body:"NewsCard_body__OdhJz",title:"NewsCard_title__WyhML",summary:"NewsCard_summary__EYmvD",meta:"NewsCard_meta__7xLcK",source:"NewsCard_source___WCHw",date:"NewsCard_date__tt3Qu",patButton:"NewsCard_patButton__NBU4h",emoji:"NewsCard_emoji__SUdPj",active:"NewsCard_active__yE_Gf"}},4482:function(e){e.exports={header:"ProfileHeader_header__g5kUM",banner:"ProfileHeader_banner__Edbjm",avatarWrapper:"ProfileHeader_avatarWrapper__K_duL",avatarFallback:"ProfileHeader_avatarFallback__LuCn4",meta:"ProfileHeader_meta__U5wn_",flexRow:"ProfileHeader_flexRow__JbUlk",handle:"ProfileHeader_handle__Tgfeg",bio:"ProfileHeader_bio__6Y4vv",date:"ProfileHeader_date__kQPnO",statsRow:"ProfileHeader_statsRow__g3e5L",followBtn:"ProfileHeader_followBtn__wQY_g",following:"ProfileHeader_following__4NyFh"}}},function(e){e.O(0,[7123,83,1467,2972,9752,7029,2971,2117,1744],function(){return e(e.s=9092)}),_N_E=e.O()}]);