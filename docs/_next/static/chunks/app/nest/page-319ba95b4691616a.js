(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8654],{2782:function(e,t,a){Promise.resolve().then(a.bind(a,3495))},3495:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var s=a(7437),n=a(2265),r=a(9376),o=a(3595),i=a(8349),l=a(5323),c=a(8950),d=a.n(c);let u=e=>{var t,a,s,n,r,o,i,l,c,d,u,h,m,v,_,N,p,f,g,x,b,j;let k=null!==(i=null!==(o=null!==(r=null!==(n=null!==(s=e.otherUserId)&&void 0!==s?s:e.partnerId)&&void 0!==n?n:e.recipientId)&&void 0!==r?r:e.senderId)&&void 0!==o?o:e.conversationId)&&void 0!==i?i:"",w=e.otherUserName||e.recipientName||e.senderName||e.username||e.name||"Patreek User",S="".concat(null!==(l=e.senderId)&&void 0!==l?l:"0","-").concat(null!==(c=e.recipientId)&&void 0!==c?c:"0");return{id:(null!==(d=null===(a=e.id)||void 0===a?void 0:null===(t=a.toString)||void 0===t?void 0:t.call(a))&&void 0!==d?d:k)||S,otherUserId:null!==(u=null==k?void 0:k.toString())&&void 0!==u?u:"",otherUserName:w,otherUserAvatar:null!==(m=null!==(h=e.otherUserAvatarUrl)&&void 0!==h?h:e.avatarUrl)&&void 0!==m?m:e.profileImage,lastMessage:null!==(p=null!==(N=null!==(_=null!==(v=e.lastMessage)&&void 0!==v?v:e.lastMessageBody)&&void 0!==_?_:e.body)&&void 0!==N?N:e.subject)&&void 0!==p?p:"",lastMessageAt:null!==(g=null!==(f=e.lastMessageAt)&&void 0!==f?f:e.updatedAt)&&void 0!==g?g:e.createdAt,unreadCount:Number(null!==(j=null!==(b=null!==(x=e.unreadCount)&&void 0!==x?x:e.unread)&&void 0!==b?b:e.unreadMessages)&&void 0!==j?j:0)}},h=async e=>{var t,a,s;let n=await fetch(e,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!n.ok)throw Error("Unable to load conversations");let r=await n.json(),o=null!==(s=null!==(a=null!==(t=null==r?void 0:r.content)&&void 0!==t?t:null==r?void 0:r.data)&&void 0!==a?a:r)&&void 0!==s?s:[];return Array.isArray(o)?o.map(e=>u(e)):[]},m=e=>{if(!e)return"";let t=new Date(e).getTime();if(Number.isNaN(t))return e;let a=Math.floor((Date.now()-t)/6e4);if(a<1)return"now";if(a<60)return"".concat(a,"m ago");let s=Math.floor(a/60);return s<24?"".concat(s,"h ago"):"".concat(Math.floor(s/24),"d ago")},v=e=>{if(!e)return"PU";let t=e.trim().split(" ").filter(Boolean);return 0===t.length?"PU":t.slice(0,2).map(e=>e[0]).join("").toUpperCase()};function _(e){let{activeUserId:t,onSelectUser:a}=e,{data:r,error:o,isValidating:i}=(0,l.ZP)("/api/v1/nest/conversations",h),c=(0,n.useMemo)(()=>r?[...r].sort((e,t)=>{let a=new Date(e.lastMessageAt||"").getTime();return(new Date(t.lastMessageAt||"").getTime()||0)-(a||0)}):[],[r]);return(0,n.useEffect)(()=>{!t&&c.length>0&&a(c[0],{openChat:!1})},[t,c,a]),(0,s.jsxs)("div",{className:d().sidebar,children:[(0,s.jsxs)("div",{className:d().sidebarHeader,children:[(0,s.jsx)("p",{className:d().sidebarTitle,children:"Conversations"}),(0,s.jsx)("p",{className:d().sidebarSubtitle,children:"Tap or click to continue a DM."})]}),o&&(0,s.jsx)("p",{className:d().errorMessage,children:"Unable to load conversations."}),i&&0===c.length?(0,s.jsx)("p",{className:d().placeholder,children:"Loading conversations…"}):0===c.length?(0,s.jsx)("p",{className:d().placeholder,children:"No conversations yet."}):(0,s.jsx)("div",{className:d().list,children:c.map(e=>{var n;let r=!!(e.otherUserId&&e.otherUserId===t),o=e.lastMessage&&e.lastMessage.length>70?"".concat(e.lastMessage.slice(0,70),"…"):e.lastMessage,i=m(e.lastMessageAt);return(0,s.jsxs)("button",{type:"button","aria-pressed":r,onClick:()=>a(e,{openChat:!0}),className:"".concat(d().conversationItem," ").concat(r?d().conversationActive:""),children:[(0,s.jsx)("div",{className:d().conversationAvatar,children:e.otherUserAvatar?(0,s.jsx)("img",{src:e.otherUserAvatar,alt:"".concat(null!==(n=e.otherUserName)&&void 0!==n?n:"User"," avatar")}):(0,s.jsx)("span",{children:v(e.otherUserName)})}),(0,s.jsxs)("div",{className:d().conversationContent,children:[(0,s.jsxs)("div",{className:d().conversationTopRow,children:[(0,s.jsx)("span",{className:d().conversationName,children:e.otherUserName||"Patreek User"}),i&&(0,s.jsx)("span",{className:d().conversationTime,children:i})]}),(0,s.jsx)("p",{className:d().conversationPreview,children:o||"No messages yet."}),(0,s.jsxs)("div",{className:d().conversationBottomRow,children:[(0,s.jsx)("span",{className:d().conversationTime,children:e.lastMessageAt?new Date(e.lastMessageAt).toLocaleDateString(void 0,{month:"short",day:"numeric"}):""}),e.unreadCount?(0,s.jsx)("span",{className:d().unreadBadge,children:e.unreadCount}):null]})]})]},e.id)})})]})}let N=e=>{var t,a,s,n,r,o,i,l,c,d,u,h,m,v,_,N,p;let f=null!==(c=null===(t=(a=null!==(l=null!==(i=null!==(o=null!==(r=e.senderId)&&void 0!==r?r:e.userId)&&void 0!==o?o:e.senderUserId)&&void 0!==i?i:e.senderUsername)&&void 0!==l?l:"unknown").toString)||void 0===t?void 0:t.call(a))&&void 0!==c?c:"unknown",g=null!==(u=null!==(d=e.createdAt)&&void 0!==d?d:e.timestamp)&&void 0!==u?u:new Date().toISOString(),x=null!==(v=null!==(m=null!==(h=e.body)&&void 0!==h?h:e.text)&&void 0!==m?m:e.message)&&void 0!==v?v:"";return{id:null!==(_=null===(n=e.id)||void 0===n?void 0:null===(s=n.toString)||void 0===s?void 0:s.call(n))&&void 0!==_?_:"".concat(f,"-").concat(g),senderId:f,senderName:null!==(p=null!==(N=e.senderName)&&void 0!==N?N:e.displayName)&&void 0!==p?p:e.senderUsername,body:x,createdAt:g}},p=async e=>{var t,a,s;let n=await fetch(e,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!n.ok)throw Error("Unable to load chat history");let r=await n.json(),o=null!==(s=null!==(a=null!==(t=null==r?void 0:r.content)&&void 0!==t?t:null==r?void 0:r.data)&&void 0!==a?a:r)&&void 0!==s?s:[];return Array.isArray(o)?o.map(e=>N(e)):[]},f=e=>{if(!e)return"";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})};function g(e){let{otherUserId:t,otherUserName:a,otherUserAvatar:r,currentUserId:o,onClose:i}=e,c=null==o?void 0:o.toString(),u=t?"/api/v1/nest/messages/".concat(encodeURIComponent(t)):null,{data:h,error:m,isValidating:v,mutate:_}=(0,l.ZP)(u,u?p:null,{refreshInterval:3e3,revalidateOnFocus:!1}),N=(0,n.useMemo)(()=>h?[...h].sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()):[],[h]),[g,x]=(0,n.useState)(""),[b,j]=(0,n.useState)(!1),[k,w]=(0,n.useState)(""),S=(0,n.useRef)(null);(0,n.useEffect)(()=>{S.current&&(S.current.scrollTop=S.current.scrollHeight)},[N.length]);let y=async e=>{if(e&&e.preventDefault(),!u||!g.trim()||b)return;j(!0);let a=g.trim(),s={id:"temp-".concat(Date.now(),"-").concat(Math.random()),senderId:null!=c?c:"me",senderName:"You",body:a,createdAt:new Date().toISOString(),pending:!0};_(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...e,s]},!1),x(""),w("");try{if(!(await fetch("/api/v1/nest/message",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({recipientId:t,body:a})})).ok)throw Error("Failed to send message");await _()}catch(e){_(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.id!==s.id)},!1),w("Unable to send message. Please try again."),console.error(e)}finally{j(!1)}},M=!!u;return(0,s.jsxs)("div",{className:d().chatArea,children:[(0,s.jsxs)("div",{className:d().chatHeader,children:[i&&(0,s.jsx)("button",{type:"button",className:d().mobileBack,onClick:i,"aria-label":"Back to conversations",children:"←"}),(0,s.jsxs)("div",{className:d().chatHeaderInfo,children:[(0,s.jsx)("span",{className:d().chatUserName,children:a||"Choose a conversation"}),(0,s.jsx)("span",{className:d().chatSubtitle,children:r?"Live chat":"Message nest user"})]})]}),M?m?(0,s.jsx)("div",{className:d().chatPlaceholder,children:"Unable to load chat history."}):(0,s.jsxs)("div",{ref:S,className:d().chatMessages,children:[N.map(e=>{let t=!!(c&&e.senderId===c);return(0,s.jsxs)("div",{className:d().chatMessageRow,children:[(0,s.jsx)("div",{className:"".concat(d().chatBubble," ").concat(t?d().chatBubbleMine:""," ").concat(e.pending?d().chatBubblePending:""),children:e.body}),(0,s.jsxs)("span",{className:"".concat(d().chatTimestamp," ").concat(t?d().chatTimestampMine:""),children:[f(e.createdAt)," ",e.pending?"• Sending…":""]})]},e.id)}),v&&!N.length&&(0,s.jsx)("p",{className:d().placeholder,children:"Loading messages…"})]}):(0,s.jsx)("div",{className:d().chatPlaceholder,children:"Select a conversation to open the chat."}),M&&(0,s.jsxs)("div",{className:d().chatFooter,children:[k&&(0,s.jsx)("p",{className:d().errorMessage,children:k}),(0,s.jsxs)("form",{className:d().chatForm,onSubmit:y,children:[(0,s.jsx)("textarea",{className:d().chatInput,placeholder:"Write a message…",value:g,onChange:e=>x(e.target.value),rows:2}),(0,s.jsx)("button",{type:"submit",className:"".concat(d().sendButton," ").concat(g.trim()&&!b?d().sendButtonActive:""),disabled:b||!g.trim(),children:b?"Sending…":"Send"})]})]})]})}var x=a(7029);function b(){let e=(0,r.useRouter)(),[t,a]=(0,n.useState)(!0),[l,c]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),[m,v]=(0,n.useState)(!1),[N,p]=(0,n.useState)(null),[f,b]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let t=!0;return(async()=>{try{if(!(await (0,x.checkSessionStatus)()).authenticated){e.replace("/registration");return}if(!t)return;c(!0);let a=await (0,x.getUserProfile)();t&&h(a)}catch(t){console.error("[Nest] session check failed",t),e.replace("/registration")}finally{t&&a(!1)}})(),v("true"===localStorage.getItem("darkMode")),()=>{t=!1}},[e]),(0,n.useEffect)(()=>{let e=()=>{b(window.innerWidth<980)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,n.useEffect)(()=>{f||k(!1)},[f]);let w=(0,n.useCallback)((e,t)=>{p(e);let a=(null==t?void 0:t.openChat)!==!1;f&&a&&k(!0)},[f]),S=(0,n.useCallback)(()=>{f&&k(!1)},[f]),y=(0,n.useMemo)(()=>{var e,t,a;return null!==(a=null==u?void 0:null===(t=u.id)||void 0===t?void 0:null===(e=t.toString)||void 0===e?void 0:e.call(t))&&void 0!==a?a:""},[u]);return t?(0,s.jsxs)("div",{className:"".concat(d().page," ").concat(m?d().dark:""),children:[(0,s.jsx)(o.Z,{hasSession:!0}),(0,s.jsxs)("main",{className:d().main,children:[(0,s.jsxs)("div",{className:d().intro,children:[(0,s.jsx)("h1",{className:d().introTitle,children:"Message Nest"}),(0,s.jsx)("p",{className:d().introSubtitle,children:"Loading conversations…"})]}),(0,s.jsx)("div",{className:d().chatPlaceholder,children:"Hang tight while we connect you to the nest."})]}),(0,s.jsx)(i.Z,{})]}):l?(0,s.jsxs)("div",{className:"".concat(d().page," ").concat(m?d().dark:""),children:[(0,s.jsx)(o.Z,{hasSession:!0}),(0,s.jsxs)("main",{className:d().main,children:[(0,s.jsxs)("div",{className:d().intro,children:[(0,s.jsx)("h1",{className:d().introTitle,children:"Message Nest"}),(0,s.jsx)("p",{className:d().introSubtitle,children:"A Twitter DM inspired experience for your stack."})]}),(0,s.jsxs)("section",{className:d().layout,children:[(0,s.jsx)("div",{className:"".concat(d().sidebar," ").concat(f&&j?d().mobileHidden:""),children:(0,s.jsx)(_,{activeUserId:null==N?void 0:N.otherUserId,onSelectUser:w})}),(0,s.jsx)("div",{className:"".concat(d().chatColumn," ").concat(f&&!j?d().mobileHidden:""),children:(0,s.jsx)(g,{otherUserId:null==N?void 0:N.otherUserId,otherUserName:null==N?void 0:N.otherUserName,otherUserAvatar:null==N?void 0:N.otherUserAvatar,currentUserId:y,onClose:f?S:void 0})})]})]}),(0,s.jsx)(i.Z,{})]}):null}},8349:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(7437),n=a(7648),r=a(3145),o=a(1468),i=a.n(o);function l(){return(0,s.jsx)("footer",{className:i().footer,children:(0,s.jsxs)("div",{className:i().container,children:[(0,s.jsxs)("div",{className:i().footerGrid,children:[(0,s.jsx)(n.default,{href:"/",className:i().logoLink,children:(0,s.jsx)(r.default,{src:"https://cdn.prod.website-files.com/675ca775325477a121669e3c/675caa3a2f73ad268a86b51a_Patreek%20logo_slogan.png",alt:"Patreek",width:111,height:60,className:i().footerLogo})}),(0,s.jsxs)("div",{className:i().footerColumn,children:[(0,s.jsx)("div",{className:i().columnTitle,children:"Product"}),(0,s.jsx)(n.default,{href:"/",className:i().footerLink,children:"Home"}),(0,s.jsx)("a",{href:"https://patreek.com/features",className:i().footerLink,target:"_blank",rel:"noopener noreferrer",children:"Features"}),(0,s.jsx)("a",{href:"https://patreek.com/pricing",className:i().footerLink,target:"_blank",rel:"noopener noreferrer",children:"Pricing"})]}),(0,s.jsxs)("div",{className:i().footerColumn,children:[(0,s.jsx)("div",{className:i().columnTitle,children:"Company"}),(0,s.jsx)("a",{href:"https://patreek.com/about",className:i().footerLink,target:"_blank",rel:"noopener noreferrer",children:"About"}),(0,s.jsx)("a",{href:"https://patreek.com/contact",className:i().footerLink,target:"_blank",rel:"noopener noreferrer",children:"Contact"}),(0,s.jsx)(n.default,{href:"/privacy",className:i().footerLink,children:"Privacy Policy"}),(0,s.jsx)(n.default,{href:"/terms",className:i().footerLink,children:"Terms & Conditions"})]}),(0,s.jsxs)("div",{className:i().footerColumn,children:[(0,s.jsx)("div",{className:i().columnTitle,children:"Social"}),(0,s.jsx)("a",{href:"https://x.com/",target:"_blank",rel:"noopener noreferrer",className:i().footerLink,children:"X (Twitter)"}),(0,s.jsx)("a",{href:"https://www.instagram.com/",target:"_blank",rel:"noopener noreferrer",className:i().footerLink,children:"Instagram"}),(0,s.jsx)("a",{href:"https://www.linkedin.com/",target:"_blank",rel:"noopener noreferrer",className:i().footerLink,children:"LinkedIn"})]})]}),(0,s.jsx)("div",{className:i().divider}),(0,s.jsxs)("div",{className:i().footerBottom,children:[(0,s.jsxs)("div",{className:i().copyright,children:["\xa9 ",new Date().getFullYear()," Patreek. All rights reserved."]}),(0,s.jsx)("div",{className:i().companyInfo,children:"Patreek App is owned by Sentigraph Inc."})]})]})})}},1468:function(e){e.exports={footer:"Footer_footer__pQtti",container:"Footer_container__KpDnW",footerGrid:"Footer_footerGrid__K31Dz",footerColumn:"Footer_footerColumn__kGECR",columnTitle:"Footer_columnTitle__WcnMX",footerLink:"Footer_footerLink__xz_wT",logoLink:"Footer_logoLink__Xoc6g",footerLogo:"Footer_footerLogo__4BA6d",divider:"Footer_divider__YAbaq",footerBottom:"Footer_footerBottom__YIYBj",copyright:"Footer_copyright__j4atB",companyInfo:"Footer_companyInfo__xaSgf",dark:"Footer_dark__otfV8"}},8950:function(e){e.exports={page:"Nest_page___yV6N",dark:"Nest_dark__CKKHW",main:"Nest_main__J5eEH",intro:"Nest_intro__smxCu",introTitle:"Nest_introTitle__Gcqx5",introSubtitle:"Nest_introSubtitle__pDsIe",layout:"Nest_layout__DxSWs",sidebar:"Nest_sidebar__MihBh",chatColumn:"Nest_chatColumn__8fTs3",chatArea:"Nest_chatArea__lUl5r",sidebarHeader:"Nest_sidebarHeader__C_5oE",sidebarTitle:"Nest_sidebarTitle__dbiti",sidebarSubtitle:"Nest_sidebarSubtitle__pjPWz",list:"Nest_list__FtO4A",conversationItem:"Nest_conversationItem__Rsx2F",conversationActive:"Nest_conversationActive__na1JN",conversationAvatar:"Nest_conversationAvatar__dWIWq",conversationContent:"Nest_conversationContent__7b0Nx",conversationTopRow:"Nest_conversationTopRow__KZuJm",conversationName:"Nest_conversationName__6LYt0",conversationTime:"Nest_conversationTime__vVk9x",conversationPreview:"Nest_conversationPreview__CpWPW",conversationBottomRow:"Nest_conversationBottomRow__TLyYi",unreadBadge:"Nest_unreadBadge__uIbje",chatHeader:"Nest_chatHeader__9T9om",chatHeaderInfo:"Nest_chatHeaderInfo__UrdYS",chatUserName:"Nest_chatUserName__5DTks",chatSubtitle:"Nest_chatSubtitle__Fu7_Y",mobileBack:"Nest_mobileBack__5afX4",chatMessages:"Nest_chatMessages__yigPb",chatMessageRow:"Nest_chatMessageRow__B_TMz",chatBubble:"Nest_chatBubble__kbvJa",chatBubbleMine:"Nest_chatBubbleMine__MbqWZ",chatBubblePending:"Nest_chatBubblePending__aqd_F",chatTimestamp:"Nest_chatTimestamp__5vTds",chatTimestampMine:"Nest_chatTimestampMine__e6RKz",chatFooter:"Nest_chatFooter__i3sQh",chatForm:"Nest_chatForm__5zIqr",chatInput:"Nest_chatInput__ad88Q",sendButton:"Nest_sendButton__sff9g",sendButtonActive:"Nest_sendButtonActive__mtVix",chatPlaceholder:"Nest_chatPlaceholder__4hqtE",errorMessage:"Nest_errorMessage__SpWq1",placeholder:"Nest_placeholder__Ks3Eb",mobileHidden:"Nest_mobileHidden__r_6cE"}}},function(e){e.O(0,[3912,1996,2972,5726,7446,7029,3595,2971,2117,1744],function(){return e(e.s=2782)}),_N_E=e.O()}]);